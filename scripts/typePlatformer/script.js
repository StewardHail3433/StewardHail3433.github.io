class Me{constructor(){this.commands=new Map}addCommand(e,t){this.commands.set(e,t)}runCommand(e){e=e.trim(),e=e.replace("/","");let t=e.split(" ");if(t[0]&&this.commands.has(t[0])){this.commands.get(t[0])(t.slice(1));return}return"Unknown Command"}setOutputLabel(e){this.label=e}outputArgsError(e){var t,n;(n=this.label)==null||n.update(((t=this.label)==null?void 0:t.getText())+`
The command had the wrong amount of errors or not correct data type. Pleas make sure your command matches:
`+e+`
`)}outputCustomError(e,t){var n,r;(r=this.label)==null||r.update(((n=this.label)==null?void 0:n.getText())+`
`+t+` The command need is: 
`+e+`
`)}}class Pe{constructor(){this.keys={},this.keysToggled={F3:!1},this.mousePos={x:0,y:0},this.leftDown=!1,this.rightDown=!1,this.middleDown=!1,this.leftDownToggled=!1,this.rightDownToggled=!1,this.middleDownToggled=!1,this.justLeftClicked=!1,this.justRightClicked=!1,this.justMiddleClicked=!1,this.canvas=document.getElementById(s.CANVAS_ID),document.addEventListener("keydown",e=>this.handleKeyDown(e)),document.addEventListener("keyup",e=>this.handleKeyUp(e)),document.addEventListener("mousedown",e=>this.handleMouseDown(e)),document.addEventListener("mousemove",e=>this.handleMouseMove(e)),document.addEventListener("mouseup",e=>this.handleMouseUp(e)),this.canvas.addEventListener("contextmenu",function(e){e.preventDefault()})}handleKeyDown(e){e.preventDefault(),e.key in this.keysToggled||(this.keysToggled[e.key]=!1),this.keys[e.key]||(this.keysToggled[e.key]=!this.keysToggled[e.key]),this.keys[e.key]=!0}handleKeyUp(e){e.preventDefault(),this.keys[e.key]=!1}handleMouseDown(e){const t=this.canvas.getBoundingClientRect();switch(this.mousePos.x=(e.clientX-t.left)*(s.CANVAS_WIDTH/t.width),this.mousePos.y=(e.clientY-t.top)*(s.CANVAS_HEIGHT/t.height),e.button){case 0:this.leftDown=!0,this.leftDownToggled=!this.leftDownToggled,this.setJustLeftClicked(!0);break;case 1:this.middleDown=!0,this.middleDownToggled=!this.middleDownToggled,this.setJustMiddleClicked(!0);break;case 2:this.rightDown=!0,this.rightDownToggled=!this.rightDownToggled,this.setJustRightClicked(!0);break}}handleMouseMove(e){const t=this.canvas.getBoundingClientRect();this.mousePos.x=(e.clientX-t.left)*(s.CANVAS_WIDTH/t.width),this.mousePos.y=(e.clientY-t.top)*(s.CANVAS_HEIGHT/t.height)}handleMouseUp(e){const t=this.canvas.getBoundingClientRect();switch(this.mousePos.x=(e.clientX-t.left)*(s.CANVAS_WIDTH/t.width),this.mousePos.y=(e.clientY-t.top)*(s.CANVAS_HEIGHT/t.height),e.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1;break}}getKeys(){return this.keys}getKeyToggled(){return this.keysToggled}getMousePosition(){return this.mousePos}getMouseWorldPosition(e){return{x:Math.floor(e.getView().x+this.mousePos.x/e.getView().zoom),y:Math.floor(e.getView().y+this.mousePos.y/e.getView().zoom)}}getMouseWorldTilePosition(e){return{x:Math.floor((e.getView().x+this.mousePos.x/e.getView().zoom)/s.TILE_SIZE),y:Math.floor((e.getView().y+this.mousePos.y/e.getView().zoom)/s.TILE_SIZE)}}isLeftDown(){return this.leftDown}isRightDown(){return this.rightDown}isMiddleDown(){return this.middleDown}wasJustLeftClicked(){return this.justLeftClicked}setJustLeftClicked(e){this.justLeftClicked=e}wasJustRightClicked(){return this.justRightClicked}setJustRightClicked(e){this.justRightClicked=e}wasJustMiddleClicked(){return this.justMiddleClicked}setJustMiddleClicked(e){this.justMiddleClicked=e}setToggle(e,t){this.keysToggled[e]=t}checkControl(e){return e=="MLeft"?this.isLeftDown():e=="MRight"?this.isRightDown():e=="MMiddle"?this.isMiddleDown():this.getKeys()[e]}checkControlToggle(e){return e=="MLeft"?this.leftDownToggled:e=="MRight"?this.rightDownToggled:e=="MMiddle"?this.middleDownToggled:this.getKeyToggled()[e]}setKey(e,t){this.keys[e]=t}}class ke{constructor(){this.time=0,this.dt=0,this.paused=!1}addTime(e){this.paused||(this.dt=e,this.time+=e)}getTime(){return this.time}pause(){this.paused=!0}unPause(){this.paused=!1}getDeltaTime(){return this.dt}}const k=class k{static get INPUT_HANDLER(){return this._inputHandler===null&&(this._inputHandler=new Pe),this._inputHandler}};k.CANVAS_WIDTH=640,k.CANVAS_HEIGHT=360,k.TILE_SIZE=16,k.WORLD_WIDTH=50,k.WORLD_HEIGHT=50,k.COMMAND_SYSTEM=new Me,k.CHUNK_SIZE=16,k.RENDER_DISTANCE=7,k.CANVAS_ID="gameCanvas",k.TIME_HANDLER=new ke,k._inputHandler=null;let s=k;class Ne{constructor(e,t){this.view=e,this.id=t,s.COMMAND_SYSTEM.addCommand("zoom",n=>{n[0]==this.id&&(this.view.zoom=parseFloat(n[1]))})}update(){if(this.currentTrackEntity){let e=this.currentTrackEntity.getHitboxComponent().getHitbox();this.view.x=e.x+e.width/2-this.view.width/2/this.view.zoom,this.view.y=e.y+e.height/2-this.view.height/2/this.view.zoom}}getView(){return{...this.view}}trackEntity(e){this.currentTrackEntity=e}stopTracking(){this.currentTrackEntity=void 0}setView(e){this.view=e}}class re{constructor(e,t){this.health=e,this.maxHealth=t}damage(e){this.health-=e}heal(e){this.health=Math.min(e,this.maxHealth)}getHealth(){return this.health}setHealth(e){this.health=e}getMaxHealth(){return this.maxHealth}setMaxHealth(e){this.maxHealth=e}isDead(){return this.health<=0}}class O{constructor(e,t={red:0,green:0,blue:0,alpha:0}){this.hitbox=e,this.color=t}getHitbox(){return{...this.hitbox}}setHitbox(e){this.hitbox={...e}}getColor(){return{...this.color}}setColor(e){if(e.hex===void 0)this.color={...e};else{let t=e.hex;t.length===3&&(t=t.split("").map(m=>m+m).join(""));const n=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),h=parseInt(t.substring(4,6),16),l=parseInt(t.substring(6,8),16);this.color={red:n,green:r,blue:h,alpha:l}}}serialize(){return{hitbox:{...this.hitbox},color:{...this.color}}}static deserialize(e){return new O(e.hitbox,e.color)}}const ue=class ue{static getImages(){return this.images}static async loadAllImages(){const e=[];for(let t=0;t<this.imageSrcs.length;t++)e.push(this.loadImage(this.imageSrcs[t]));return this.images=await Promise.all(e),this.images}static loadImage(e){return new Promise((t,n)=>{let r=new Image;r.onload=()=>{console.log("Image: Succesfully loaded -> "+e),t(r)},r.onerror=()=>{console.log("Failed loading -> "+e),n(new Error("Failed to load image: "+e))},r.src=e})}};ue.images=[],ue.imageSrcs=["resources/typePlatformer/images/tiles/fields.png","resources/typePlatformer/images/tiles/tree_leaves.png","resources/typePlatformer/images/tiles/tree_stump.png","resources/typePlatformer/images/entity/player/playerSheet.png","resources/typePlatformer/images/entity/player/playerSheet3.png","resources/typePlatformer/images/items/stick.png","resources/typePlatformer/images/items/sword.png","resources/typePlatformer/images/items/pickaxe.png","resources/typePlatformer/images/entity/player/playerSheet2.png","resources/typePlatformer/images/entity/player/duckMan.png","resources/typePlatformer/images/entity/player/theVoid.png","resources/typePlatformer/images/misc/mouseSelction.png","resources/typePlatformer/images/misc/breaking.png","resources/typePlatformer/images/items/tree_leaves.png","resources/typePlatformer/images/items/tree_stump.png","resources/typePlatformer/images/items/wood.png","resources/typePlatformer/images/items/rock.png","resources/typePlatformer/images/items/grass.png","resources/typePlatformer/images/tiles/wood.png","resources/typePlatformer/images/tiles/potion_bowl.png","resources/typePlatformer/images/items/speed_up_potion.png","resources/typePlatformer/images/items/sword2.png","resources/typePlatformer/images/tiles/tool_loot_box.png","resources/typePlatformer/images/items/flesh.png","resources/typePlatformer/images/menu/main.png","resources/typePlatformer/images/tiles/big_tree_tl.png","resources/typePlatformer/images/tiles/big_tree_bl.png","resources/typePlatformer/images/tiles/big_tree_ml.png","resources/typePlatformer/images/tiles/big_tree_tr.png","resources/typePlatformer/images/tiles/big_tree_br.png","resources/typePlatformer/images/tiles/big_tree_mr.png","resources/typePlatformer/images/items/big_tree_tl.png","resources/typePlatformer/images/items/big_tree_bl.png","resources/typePlatformer/images/items/big_tree_ml.png","resources/typePlatformer/images/items/big_tree_tr.png","resources/typePlatformer/images/items/big_tree_br.png","resources/typePlatformer/images/items/big_tree_mr.png"];let w=ue;class z{constructor(e,t,n="This is an item(I think)",r={isBlockItem:!1,isConsumable:!1},h=l=>{}){this.maxStackAmount=999,this.id=e,this.name=t,this.discription=n,this.settings=r,this.consumeAction=h}loadImage(){let e="resources/typePlatformer/images/items/"+this.id+".png";w.getImages().forEach(t=>{var n;t.src.substring((n=t.src.match("resources"))==null?void 0:n.index)===e&&(this.img=t)})}getDiscription(){return this.discription}getImage(){return this.img}getMaxStackAmount(){return this.maxStackAmount}getId(){return this.id}getSettings(){return{...this.settings}}getConsumableAction(){return this.consumeAction}}class ee extends z{constructor(e,t,n="This is an Tool item(I think)",r={width:12,height:16},h=9,l={step:5,totalRotationAmount:180}){super(e,t,n),this.damage=1,this.swingAngle={step:5,totalRotationAmount:180},this.hitbox=r,this.damage=h,this.swingAngle=l}getHitbox(){return this.hitbox}getDamage(){return this.damage}getSwingAngleSettings(){return this.swingAngle}}const P=class P{static getItemById(e){return this.items[e]?this.items[e]:this.EMPTY}static loadItemsImgs(){for(const e in this.items)this.items[e].loadImage()}static registerTileItem(e){return this.items[e.getId()]=new z(e.getId(),e.getName(),"THIS IS A BLOCK",{isBlockItem:!0,isConsumable:!1}),this.items[e.getId()]}};P.EMPTY=new z("empty","empty"),P.SWORD=new z("sword","Sword",`This is sharp
Be careful`),P.STICK=new z("stick","Stick","This is a stick"),P.FLESH=new z("flesh","Flesh","Rotten"),P.PICKAXE=new ee("pickaxe","Pickaxe","Lets Mine",{width:5,height:16},10),P.SWORD_2=new ee("sword2","Sword 2","Lets Mine",{width:6,height:22},20,{step:4,totalRotationAmount:180}),P.SPEED_UP_POTION=new z("speed_up_potion","Speed Up Potion","Speed Me Up",{...P.EMPTY.getSettings(),isConsumable:!0},e=>{e.setSpeed(e.getSpeed()+30)}),P.items={},(()=>{for(const e of Object.getOwnPropertyNames(P)){const t=P[e];t instanceof z&&(P.items[t.getId()]=t)}})();let v=P;class K{constructor(e,t){e?(this.item=e,t?this.count=t:this.count=1,this.empty=!1):(this.item=v.EMPTY,this.count=0,this.empty=!0)}setItem(e,t){this.item=e,this.count=t,this.empty=!1}removeItem(){this.item=v.EMPTY,this.count=0,this.empty=!0}removeCount(e){this.count-=e,this.count<=0&&(this.item=v.EMPTY,this.count=0,this.empty=!0)}isEmpty(){return this.empty}addItems(e){let t=this.count;return this.item.getMaxStackAmount()<t+e?(this.count=this.item.getMaxStackAmount(),t+e-this.item.getMaxStackAmount()):(this.count=this.count+e,0)}getItem(){return this.item}getItemCount(){return this.count}getMaxItemCount(){return this.item.getMaxStackAmount()}}class J{constructor(e,t){this.inventory=[],this.selectedSlotIndex=0,this.type="inventory",this.size=e;for(let n=0;n<this.size;n++)this.inventory.push(new K);t&&(this.type=t)}getSize(){return this.size}getType(){return this.type}setSelecteSlot(e){this.selectedSlotIndex=e}getSelecteSlot(){return this.inventory[this.selectedSlotIndex]}getSelecteSlotIndex(){return this.selectedSlotIndex}getSlot(e){return this.inventory[e]}clear(){for(let e=0;e<this.size;e++)this.inventory[e].removeItem()}static transferItems(e,t){let n=0,r=-1;if(t.getItem().getId()!="empty"){for(let h=0;h<e.getSize();h++){const l=e.getSlot(h);if(l.isEmpty()&&r==-1&&(r=h),l.getItem().getId()==t.getItem().getId()){if(n===0){if(n=l.addItems(t.getItemCount()),n===0){t.removeItem();break}}else if(n=l.addItems(n),n===0){t.removeItem();break}}}if(r!=-1)for(let h=r;h<e.getSize();h++){const l=e.getSlot(h);if(l.isEmpty()){if(n===0){if(t.getItemCount()>t.getItem().getMaxStackAmount()?(l.setItem(t.getItem(),t.getItem().getMaxStackAmount()),n=t.getItemCount()-t.getItem().getMaxStackAmount()):(l.setItem(t.getItem(),t.getItemCount()),n=0),n===0){t.removeItem();break}}else if(n>t.getItem().getMaxStackAmount()?(l.setItem(t.getItem(),t.getItem().getMaxStackAmount()),n=n-t.getItem().getMaxStackAmount()):(l.setItem(t.getItem(),n),n=0),n===0){t.removeItem();break}}}else n=t.getItemCount()}return n<=0&&t.removeItem(),t}}function N(_,e){return _.x>e.x*1&&_.x<(e.x+e.width)*1&&_.y>e.y*1&&_.y<(e.y+e.height)*1}function te(_,e){return _.x<e.x+e.width&&_.x+_.width>e.x&&_.y<e.y+e.height&&_.y+_.height>e.y}function we(_){return[[_.x,_.y],[_.x+_.width,_.y],[_.x+_.width,_.y+ +_.height],[_.x,_.y+ +_.height]]}function De(_,e){for(let t=0;t<_.length;t++)for(let n=0;n<e.length;n++)if(Re([_[t],_[(t+1)%_.length]],[e[n],e[(n+1)%e.length]]))return!0;return!1}function Re(_,e){const t=(e[1][1]-e[0][1])*(_[1][0]-_[0][0])-(e[1][0]-e[0][0])*(_[1][1]-_[0][1]),n=(e[1][0]-e[0][0])*(_[0][1]-e[0][1])-(e[1][1]-e[0][1])*(_[0][0]-e[0][0]),r=(_[1][0]-_[0][0])*(_[0][1]-e[0][1])-(_[1][1]-_[0][1])*(_[0][0]-e[0][0]);if(t==0)return n==0&&r==0;const h=n/t,l=r/t;return h>=0&&h<=1&&l>=0&&l<=1}function ve(_,e,t,n){_.save(),_.translate(t.x,t.y),_.rotate(n),_.drawImage(e,0,0),_.restore()}function Ce(_,e,t,n,r,h,l,m){const c=s.TIME_HANDLER.getTime()-Math.floor(s.TIME_HANDLER.getTime());let p=Math.floor(c*t)%4,I=0;switch(n){case"down":I=0;break;case"up":I=s.TILE_SIZE;break;case"left":I=s.TILE_SIZE*2,p=Math.floor(c*t)%6;break;case"right":I=s.TILE_SIZE*3,p=Math.floor(c*t)%6;break}let i=p*s.TILE_SIZE;_.drawImage(e,i,I,l,m,r,h,l,m)}class He{constructor(e,t){this.velocity={x:0,y:0},this.inputVel={x:0,y:0},this.externalForceVel={x:0,y:0},this.speed=120,this.direction="down",this.layer=0,this.toolHitbox={pts:[],angle:-90},this.usingSlot=new K,this.lastDirection="down",this.directionChanged=!1,this.tp={x:0,y:0},this.path=[],this.onPath=!1,this.atGoal=!1,this.pathTime=0,this.usingTool=!1,this.type="unknown",this.invincibilityTimeAmount=.17,this.hitInfo={hit:!1,loseInvincibility:0},this.externalTime=0,this.externalDecay=1,this.healthComponent=e,this.hitboxComponent=t}update(){let e=Math.sqrt(this.inputVel.x*this.inputVel.x+this.inputVel.y*this.inputVel.y);e>0?(this.inputVel.x=Math.abs(this.inputVel.x)*(this.inputVel.x/e),this.inputVel.y=Math.abs(this.inputVel.y)*(this.inputVel.y/e)):(this.inputVel.x=0,this.inputVel.y=0),this.velocity.x=this.inputVel.x,this.velocity.y=this.inputVel.y,this.externalTime>0&&(this.externalTime-=s.TIME_HANDLER.getDeltaTime(),this.velocity.x+=this.externalForceVel.x*(this.externalTime/this.externalDecay),this.velocity.y+=this.externalForceVel.y*(this.externalTime/this.externalDecay),this.externalTime<=0&&(this.externalForceVel={x:0,y:0})),this.updateBeenHit(),this.updateDirection(),this.updateToolItem(this.usingSlot.getItem())}updateBeenHit(){this.hitInfo.hit&&this.hitInfo.loseInvincibility<=s.TIME_HANDLER.getTime()&&(this.hitInfo.hit=!1)}updateDirection(){this.lastDirection=this.direction,Math.sign(this.velocity.y)==-1&&(this.direction="up"),Math.sign(this.velocity.y)==1&&(this.direction="down"),Math.sign(this.velocity.x)==1&&(this.direction="right"),Math.sign(this.velocity.x)==-1&&(this.direction="left"),!this.directionChanged&&this.direction!=this.lastDirection?this.directionChanged=!0:this.directionChanged=!1}updateToolItem(e){if(e instanceof ee){const t=e,n=this.hitboxComponent.getHitbox();let r=n.x+n.width/2,h=n.y+n.height/2;this.toolHitbox.pts=we({...t.getHitbox(),x:r-t.getHitbox().width/2,y:h-t.getHitbox().height});const l=this.getDirectionAsAngle()-t.getSwingAngleSettings().totalRotationAmount/2,m=this.getDirectionAsAngle()+t.getSwingAngleSettings().totalRotationAmount/2;this.toolHitbox.angle+=t.getSwingAngleSettings().step,this.toolHitbox.angle>m&&(this.toolHitbox.angle=l);for(let c=0;c<this.toolHitbox.pts.length;c++){const p=this.toolHitbox.pts[c][0],I=this.toolHitbox.pts[c][1];this.toolHitbox.pts[c]=[Math.cos(this.toolHitbox.angle*(Math.PI/180))*(p-r)-Math.sin(this.toolHitbox.angle*(Math.PI/180))*(I-h)+r,Math.sin(this.toolHitbox.angle*(Math.PI/180))*(p-r)+Math.cos(this.toolHitbox.angle*(Math.PI/180))*(I-h)+h]}}}getDirectionAsAngle(){return this.direction=="right"?90:this.direction=="down"?180:this.direction=="left"?270:0}render(e){const t=this.hitboxComponent.getHitbox(),n=this.hitboxComponent.getColor();e.fillStyle="rgb("+n.red.toString()+","+n.green.toString()+","+n.blue.toString()+")",e.fillRect(t.x,t.y,t.width,t.height)}renderUsingItem(e){if(this.usingTool&&this.usingSlot.getItem()instanceof ee){if(e.strokeStyle="red",e.lineWidth=.5,s.INPUT_HANDLER.checkControlToggle("F3")&&s.INPUT_HANDLER.checkControlToggle("b")){e.moveTo(this.toolHitbox.pts[0][0],this.toolHitbox.pts[0][1]),e.beginPath();for(let t=0;t<this.toolHitbox.pts.length;t++)e.lineTo(this.toolHitbox.pts[t][0],this.toolHitbox.pts[t][1]);e.lineTo(this.toolHitbox.pts[0][0],this.toolHitbox.pts[0][1]),e.closePath(),e.stroke()}this.toolHitbox.pts[0]&&ve(e,this.usingSlot.getItem().getImage(),{x:this.toolHitbox.pts[0][0],y:this.toolHitbox.pts[0][1]},this.toolHitbox.angle*(Math.PI/180))}}getHitboxComponent(){return this.hitboxComponent}getDirection(){return this.direction}getSpeed(){return this.speed}setSpeed(e){this.speed=e}getVelocity(){return this.velocity}setVelocity(e){this.velocity=e}getLayer(){return this.layer}followPathAction(){if(this.onPath&&this.path.length>0)if(this.pathTime<200){const e=this.path[0],t=this.getHitboxComponent().getHitbox(),n=e.getPos().x*s.TILE_SIZE+s.TILE_SIZE/2,r=e.getPos().y*s.TILE_SIZE+s.TILE_SIZE/2,h=n-(t.x+t.width/2),l=r-(t.y+t.height/2);Math.abs(h)>=1?(this.inputVel.x=Math.sign(h)*this.speed,this.inputVel.y=0):Math.abs(l)>=1?(this.inputVel.y=Math.sign(l)*this.speed,this.inputVel.x=0):(this.hitboxComponent.setHitbox({...t,x:n-t.width/2,y:r-t.height/2}),this.path.shift(),this.inputVel.x=0,this.inputVel.y=0),this.pathTime++,this.path.length==0?(this.onPath=!1,this.atGoal=!0,console.log("end"),this.inputVel.x=0,this.inputVel.y=0,this.pathTime=0):this.atGoal=!1}else this.onPath=!1,this.pathTime=0,this.path=[]}setTargetPt(e){this.tp=e}setPath(e){if(this.path=e,this.path.length>0)if(this.onPath=!0,this.path.length>1){const t=this.path[1],n=this.getHitboxComponent().getHitbox(),r=t.getPos().x*s.TILE_SIZE+s.TILE_SIZE/2,h=t.getPos().y*s.TILE_SIZE+s.TILE_SIZE/2,l=r-(n.x+n.width/2),m=h-(n.y+n.height/2);Math.sign(l)==Math.sign(this.velocity.x)&&this.velocity.y==0?this.path.shift():Math.sign(m)==Math.sign(this.velocity.y)&&this.velocity.x==0?this.path.shift():(this.velocity.x=0,this.velocity.y=0)}else this.velocity.x=0,this.velocity.y=0;else this.onPath=!1}getPath(){return this.path}isUsingTool(){return this.usingTool}getToolSlot(){return this.usingSlot}getToolHitboxPts(){return this.toolHitbox.pts}applyKnockback(e,t){const n=this.hitboxComponent.getHitbox(),r=n.x+n.width/2,h=n.y+n.height/2,l=e.x-r,m=e.y-h,c=Math.atan2(m,l);this.externalForceVel.x-=t*Math.cos(c),this.externalForceVel.y-=t*Math.sin(c),this.externalTime=this.externalDecay,(Math.abs(this.externalForceVel.x)>t*Math.cos(c)||Math.abs(this.externalForceVel.y)>t*Math.sin(c))&&(this.externalForceVel.x=Math.sign(this.externalForceVel.x)*t*Math.cos(c),this.externalForceVel.y=Math.sign(this.externalForceVel.x)*t*Math.sin(c))}getType(){return this.type}getHealthComponent(){return this.healthComponent}getWorldPosition(){return{x:Math.floor(this.hitboxComponent.getHitbox().x/s.TILE_SIZE),y:Math.floor(this.hitboxComponent.getHitbox().y/s.TILE_SIZE)}}hit(e){this.getHealthComponent().damage(e),this.hitInfo.hit=!0,this.hitInfo.loseInvincibility=s.TIME_HANDLER.getTime()+this.invincibilityTimeAmount}isHit(){return this.hitInfo.hit}}class Ae extends He{constructor(e,t,n){super(t,n),this.controls={up:"w",down:"s",left:"a",right:"d",inventory:"e",break:"MLeft",useTool:"MLeft",place:"MRight",drop:"q",selectSlot0:"1",selectSlot1:"2",selectSlot2:"3",selectSlot3:"4",selectSlot4:"5",selectSlot5:"6",selectSlot6:"7",useItem:"MRight",debug:"F3"},this.frame=0,this.isBreaking=!1,this.inventory=new J(14,"mainInventory"),this.hotbar=new J(7,"hotbar"),this.isArrows=!1,this.name=e,this.speed=60,this.type="player",this.setControls(),this.inventory.getSlot(10).setItem(v.STICK,1),this.inventory.getSlot(12).setItem(v.SWORD,1),this.hotbar.setSelecteSlot(0),this.img=w.getImages()[4],s.COMMAND_SYSTEM.addCommand("tp",r=>{this.hitboxComponent.setHitbox({...n.getHitbox(),x:parseFloat(r[0]),y:parseFloat(r[1])})}),s.COMMAND_SYSTEM.addCommand("speed",r=>{this.speed=parseFloat(r[0])}),s.COMMAND_SYSTEM.addCommand("give",r=>{let h=new K(v.getItemById(r[1]),parseInt(r[2]));r[0]=="self"&&(h=J.transferItems(this.hotbar,h))}),s.COMMAND_SYSTEM.addCommand("clear",r=>{r[0]=="self"&&(this.inventory.clear(),this.hotbar.clear())}),s.COMMAND_SYSTEM.addCommand("layer",r=>{this.layer=parseInt(r[0])}),s.COMMAND_SYSTEM.addCommand("setControl",r=>{r[0]in this.controls&&(this.controls[r[0]]=r[1])}),s.COMMAND_SYSTEM.addCommand("heal",r=>{t.heal(Number(r[0]))})}setControls(e={up:"w",down:"s",left:"a",right:"d",inventory:"e",break:"MLeft",useTool:"MLeft",place:"MRight",drop:"q",selectSlot0:"1",selectSlot1:"2",selectSlot2:"3",selectSlot3:"4",selectSlot4:"5",selectSlot5:"6",selectSlot6:"7",useItem:"MRight",debug:"F3"}){this.controls=e}update(){this.inputVel={x:0,y:0},this.healthComponent.isDead()||(s.INPUT_HANDLER.checkControl(this.controls.up)&&(this.inputVel.y=-this.speed),s.INPUT_HANDLER.checkControl(this.controls.down)&&(this.inputVel.y=this.speed),s.INPUT_HANDLER.checkControl(this.controls.left)&&(this.inputVel.x=-this.speed),s.INPUT_HANDLER.checkControl(this.controls.right)&&(this.inputVel.x=this.speed),s.INPUT_HANDLER.checkControl(this.controls.selectSlot0)?this.hotbar.setSelecteSlot(0):s.INPUT_HANDLER.checkControl(this.controls.selectSlot1)?this.hotbar.setSelecteSlot(1):s.INPUT_HANDLER.checkControl(this.controls.selectSlot2)?this.hotbar.setSelecteSlot(2):s.INPUT_HANDLER.checkControl(this.controls.selectSlot3)?this.hotbar.setSelecteSlot(3):s.INPUT_HANDLER.checkControl(this.controls.selectSlot4)?this.hotbar.setSelecteSlot(4):s.INPUT_HANDLER.checkControl(this.controls.selectSlot5)?this.hotbar.setSelecteSlot(5):s.INPUT_HANDLER.checkControl(this.controls.selectSlot6)&&this.hotbar.setSelecteSlot(6),this.frame+=1,s.INPUT_HANDLER.checkControl("p")&&(this.isArrows?(this.setControls(),this.isArrows=!1):(this.setControls({...this.controls,up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight"}),this.isArrows=!0),s.INPUT_HANDLER.setKey("p",!1)),s.INPUT_HANDLER.checkControl(this.controls.useTool)?this.usingTool=!0:this.usingTool=!1),super.update(),this.healthComponent.isDead()||this.updateToolItem(this.hotbar.getSelecteSlot().getItem())}getControls(){return{...this.controls}}setName(e){this.name=e}getName(){return this.name}isMoving(){return this.velocity.x!=0||this.velocity.y!=0}render(e){const t=this.hitboxComponent.getHitbox();this.velocity.x!=0||this.velocity.y!=0?(e.imageSmoothingEnabled=!1,Ce(e,this.img,20/3,this.direction,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE)):this.direction==="up"?e.drawImage(this.img,0,s.TILE_SIZE*1,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE):this.direction==="down"?e.drawImage(this.img,0,0,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE):this.direction==="right"?e.drawImage(this.img,0,s.TILE_SIZE*3,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE):this.direction==="left"&&e.drawImage(this.img,s.TILE_SIZE*2,s.TILE_SIZE*2,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE),this.renderUsingItem(e),s.INPUT_HANDLER.getKeyToggled().F3&&s.INPUT_HANDLER.getKeyToggled().b&&super.render(e)}renderUsingItem(e){if(this.usingTool&&this.hotbar.getSelecteSlot().getItem()instanceof ee){if(e.strokeStyle="red",e.lineWidth=.5,s.INPUT_HANDLER.checkControlToggle("F3")&&s.INPUT_HANDLER.checkControlToggle("b")){e.moveTo(this.toolHitbox.pts[0][0],this.toolHitbox.pts[0][1]),e.beginPath();for(let t=0;t<this.toolHitbox.pts.length;t++)e.lineTo(this.toolHitbox.pts[t][0],this.toolHitbox.pts[t][1]);e.lineTo(this.toolHitbox.pts[0][0],this.toolHitbox.pts[0][1]),e.closePath(),e.stroke()}this.toolHitbox.pts[0]&&ve(e,this.hotbar.getSelecteSlot().getItem().getImage(),{x:this.toolHitbox.pts[0][0],y:this.toolHitbox.pts[0][1]},this.toolHitbox.angle*(Math.PI/180))}}setImage(e){this.img=e}getHotbarInventory(){return this.hotbar}getMainInventory(){return this.inventory}getBreaking(){return this.isBreaking}setBreaking(e){this.isBreaking=e}setToolUsing(e){this.usingTool=e}getToolSlot(){return this.hotbar.getSelecteSlot()}}class F extends O{constructor(e,t={red:255,green:0,blue:255,alpha:1},n){return super(e,t),this.text="",this.hidden=n,this}render(e){if(!this.hidden){this.color.alpha?e.fillStyle="rgba("+this.color.red+","+this.color.green+","+this.color.blue+", "+this.color.alpha+")":e.fillStyle="rgb("+this.color.red+","+this.color.green+","+this.color.blue+")";var t=this.hitbox.x,n=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const r=this.parentComponent.getHitbox();t+=r.x,n+=r.y}e.fillRect(t,n,this.hitbox.width,this.hitbox.height)}}hide(){this.hidden=!0}show(){this.hidden=!1}isHidden(){return this.hidden}update(e=this.text){}setParentComponent(e){this.parentComponent=e}}class Q extends F{constructor(e,t={red:255,green:0,blue:255,alpha:1},n,r="",h={red:0,green:0,blue:0,alpha:1},l=8,m="left",c=!1){super(e,t,n),this.lockTextHeight=!1,this.text=r,this.textColor=h,this.fontSize=l,this.textAlign=m,this.lockTextHeight=c}render(e){if(this.hidden)return;super.render(e);var t=this.hitbox.x,n=this.hitbox.y;if(this.parentComponent){const c=this.parentComponent.getHitbox();t+=c.x,n+=c.y}e.textAlign=this.textAlign,this.textColor.alpha?e.fillStyle="rgba("+this.textColor.red+","+this.textColor.green+","+this.textColor.blue+", "+this.textColor.alpha+")":e.fillStyle="rgb("+this.textColor.red+","+this.textColor.green+","+this.textColor.blue+")",e.font=this.fontSize+"px serif";let r=[],h=this.text.split(`
`),l=this.fontSize*1.2,m=Math.round(this.hitbox.height/l);for(let c of h){let p=c.split(" "),I="";for(let i of p){let o=I.length===0?i:I+" "+i;e.measureText(o).width>this.hitbox.width&&I.length>0?(r.push(I),I=i):I=o}I&&r.push(I)}this.lockTextHeight&&r.length>m&&(r=r.slice(r.length-m)),n-=3;for(let c=0;c<r.length;c++){const p=r[c];this.textAlign==="left"?e.fillText(p,t,n+l):this.textAlign==="center"?e.fillText(p,t+this.hitbox.width/2,n+this.hitbox.height/2):e.fillText(p,t+this.hitbox.width/2,n+this.hitbox.height/2),n+=l}}update(e=this.text){this.text=e}getText(){return this.text}}class V extends Q{constructor(e,t,n={red:255,green:0,blue:255,alpha:1},r,h="",l={red:0,green:0,blue:0,alpha:1},m=8,c="left",p=n,I=l,i=n,o,a,d,f,g=!0){super(t,n,r,h,l,m,c),this.activeTouches=new Set,this.hoverColor=p,this.hoverTextColor=I,this.click=!1,this.defaultColor=n,this.clickColor=i,this.onTrue=o,this.onFalse=a,this.whileTrue=d,this.whileFalse=f,this.canvas=e,this.shouldOnTrue=!1,this.shouldOnFalse=g,document.addEventListener("touchstart",u=>this.handleTouchStart(u)),document.addEventListener("touchmove",u=>this.handleTouchMove(u)),document.addEventListener("touchend",u=>this.handleTouchEnd(u))}handleMouseDown(){if(s.INPUT_HANDLER.isLeftDown()){var e=this.hitbox.x,t=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const n=this.parentComponent.getHitbox();e+=n.x,t+=n.y}N(s.INPUT_HANDLER.getMousePosition(),{...this.hitbox,x:e,y:t})&&(this.click||(this.shouldOnTrue=!0),this.click=!0,this.color=this.clickColor)}}handleMouseMove(){var e=this.hitbox.x,t=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const n=this.parentComponent.getHitbox();e+=n.x,t+=n.y}N(s.INPUT_HANDLER.getMousePosition(),{...this.hitbox,x:e,y:t})?s.INPUT_HANDLER.isLeftDown()?this.color=this.clickColor:this.color=this.hoverColor:(this.click&&this.activeTouches.size===0&&(this.color=this.defaultColor,this.click=!1,this.shouldOnTrue=!1,this.shouldOnFalse=!0),this.color=this.defaultColor)}handleMouseUp(){s.INPUT_HANDLER.isLeftDown()||this.click&&this.activeTouches.size===0&&(this.color=this.defaultColor,this.click=!1,this.shouldOnTrue=!1,this.shouldOnFalse=!0)}handleTouchStart(e){var t=e.changedTouches,n=this.hitbox.x,r=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const l=this.parentComponent.getHitbox();n+=l.x,r+=l.y}for(var h=0;h<t.length;h++){let l=t[h];const m=this.canvas.getBoundingClientRect();let c=(l.clientX-m.left)*(s.CANVAS_WIDTH/m.width),p=(l.clientY-m.left)*(s.CANVAS_WIDTH/m.width);c>=0&&p>=0&&p<=s.CANVAS_HEIGHT&&c<=s.CANVAS_WIDTH&&(e.preventDefault(),N({x:c,y:p},{...this.hitbox,x:n,y:r})&&(this.activeTouches.size||(this.shouldOnTrue=!0),this.click=!0,this.activeTouches.add(l.identifier),this.color=this.clickColor))}}handleTouchMove(e){const t=this.canvas.getBoundingClientRect();var n=e.changedTouches,r=this.hitbox.x,h=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const m=this.parentComponent.getHitbox();r+=m.x,h+=m.y}for(var l=0;l<n.length;l++){let m=n[l],c=(m.clientX-t.left)*(s.CANVAS_WIDTH/t.width),p=(m.clientY-t.left)*(s.CANVAS_WIDTH/t.width);c>=0&&p>=0&&p<=s.CANVAS_HEIGHT&&c<=s.CANVAS_WIDTH&&(e.preventDefault(),N({x:c,y:p},{...this.hitbox,x:r,y:h})?this.color=this.hoverColor:this.color=this.defaultColor)}}handleTouchEnd(e){const t=this.canvas.getBoundingClientRect();for(var n=e.changedTouches,r=0;r<n.length;r++){let h=n[r],l=(h.clientX-t.left)*(s.CANVAS_WIDTH/t.width),m=(h.clientY-t.left)*(s.CANVAS_WIDTH/t.width);l>=0&&m>=0&&m<=s.CANVAS_HEIGHT&&l<=s.CANVAS_WIDTH&&e.preventDefault(),this.activeTouches.has(h.identifier)&&this.activeTouches.delete(h.identifier)}this.activeTouches.size===0&&(this.color=this.defaultColor,this.click=!1,this.shouldOnTrue=!1,this.shouldOnFalse=!0)}update(e=this.text){this.handleMouseDown(),this.handleMouseMove(),this.handleMouseUp(),super.update(e),this.click=this.activeTouches.size>0||this.click,this.hidden||(this.click?(this.shouldOnTrue&&this.onTrue&&(this.onTrue(),this.shouldOnTrue=!1),this.whileTrue&&this.whileTrue()):(this.shouldOnFalse&&this.onFalse&&(this.onFalse(),this.shouldOnFalse=!1),this.whileFalse&&this.whileFalse()))}setOnTrue(e){this.onTrue=e}setOnFalse(e){this.onFalse=e}setWhileTrue(e){this.whileTrue=e}setWhileFalse(e){this.whileFalse=e}render(e){this.hidden||super.render(e)}}class Ze extends F{constructor(e,t={red:255,green:0,blue:255,alpha:1},n,r,h){super(e,t,n),this.image=r,this.sHitbox=h}render(e){var r,h,l,m;if(!this.hidden){super.render(e),e.imageSmoothingEnabled=!1,e.imageSmoothingQuality="high";var t=this.hitbox.x,n=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const c=this.parentComponent.getHitbox();t+=c.x,n+=c.y}this.sHitbox?e.drawImage(this.image,(r=this.sHitbox)==null?void 0:r.x,(h=this.sHitbox)==null?void 0:h.y,(l=this.sHitbox)==null?void 0:l.width,(m=this.sHitbox)==null?void 0:m.height,t,n,this.hitbox.width,this.hitbox.height):e.drawImage(this.image,t,n,this.hitbox.width,this.hitbox.height)}}setImage(e,t){this.image=e,t&&(this.sHitbox=t)}}class Ve{constructor(e,t,n){this.characterIndex=1,this.player=n,this.characterChooserComponent=t,this.characterChooserLabel=new Ze({x:5,y:5,width:90,height:90},{red:0,green:255,blue:0},!0,w.getImages()[1],{x:0,y:0,width:s.TILE_SIZE,height:s.TILE_SIZE}),this.characterChooserLeftButton=new V(e,{x:5,y:105,width:25,height:25},{red:0,green:255,blue:0},!0,"<=",void 0,8,"center",void 0,void 0,void 0,()=>{let r=this.characterIndex;do if(this.characterIndex-1>-1)this.characterIndex--;else break;while(!w.getImages()[this.characterIndex].src.includes("resources/typePlatformer/images/entity/player"));w.getImages()[this.characterIndex].src.includes("resources/typePlatformer/images/entity/player")?(this.characterChooserLabel.setImage(w.getImages()[this.characterIndex]),this.player.setImage(w.getImages()[this.characterIndex])):this.characterIndex=r}),this.characterChooserRightButton=new V(e,{x:70,y:105,width:25,height:25},{red:0,green:255,blue:0},!0,"=>",void 0,8,"center",void 0,void 0,void 0,()=>{let r=this.characterIndex;do if(this.characterIndex+1<w.getImages().length)this.characterIndex++;else break;while(!w.getImages()[this.characterIndex].src.includes("resources/typePlatformer/images/entity/player"));w.getImages()[this.characterIndex].src.includes("resources/typePlatformer/images/entity/player")?(this.characterChooserLabel.setImage(w.getImages()[this.characterIndex]),this.player.setImage(w.getImages()[this.characterIndex])):this.characterIndex=r}),this.initChooser()}initChooser(){this.characterChooserLabel.setParentComponent(this.characterChooserComponent),this.characterChooserLeftButton.setParentComponent(this.characterChooserComponent),this.characterChooserRightButton.setParentComponent(this.characterChooserComponent)}render(e){this.characterChooserComponent.render(e),this.characterChooserLabel.render(e),this.characterChooserLeftButton.render(e),this.characterChooserRightButton.render(e)}update(){this.characterChooserLeftButton.update(),this.characterChooserRightButton.update()}show(){this.characterChooserComponent.show(),this.characterChooserLabel.show(),this.characterChooserLeftButton.show(),this.characterChooserRightButton.show()}hide(){this.characterChooserComponent.hide(),this.characterChooserLabel.hide(),this.characterChooserLeftButton.hide(),this.characterChooserRightButton.hide()}}class Be extends Q{constructor(e,t,n={red:255,green:0,blue:255,alpha:1},r,h="Type Here...",l={red:0,green:0,blue:0,alpha:1},m=8,c="left",p=!1,I){super(t,n,r,h,l,m,c,p),this.canvas=e,this.placeholder=h,this.text="",this.boxFocus=!1,this.handleTouchStart=this.handleTouchStart.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),document.addEventListener("touchstart",this.handleTouchStart),this.onSubmit=I}handleMouseDown(){if(s.INPUT_HANDLER.isLeftDown()){var e=this.hitbox.x,t=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const n=this.parentComponent.getHitbox();e+=n.x,t+=n.y}N(s.INPUT_HANDLER.getMousePosition(),{...this.hitbox,x:e,y:t})?this.startTextElement():(this.boxFocus=!1,this.text.trim()||(this.text=this.placeholder),this.removeTextElement())}}handleTouchStart(e){e.preventDefault();const t=this.canvas.getBoundingClientRect();let n=(e.touches[0].clientX-t.left)*(s.CANVAS_WIDTH/t.width),r=(e.touches[0].clientY-t.left)*(s.CANVAS_WIDTH/t.width);var h=this.hitbox.x,l=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const m=this.parentComponent.getHitbox();h+=m.x,l+=m.y}N({x:n,y:r},{...this.hitbox,x:h,y:l})?this.startTextElement():(this.boxFocus=!1,this.text.trim()||(this.text=this.placeholder),this.removeTextElement())}handleKeyDown(e){if(this.inputElement&&(e.stopPropagation(),this.text=this.inputElement.value,e.key==="Enter")){this.boxFocus=!1,this.removeTextElement(),this.onSubmit&&this.onSubmit();return}}startTextElement(){var h;if(this.inputElement)return;let e=!1;document.fullscreenElement&&!document.getElementById("gameDiv").requestFullscreen&&(document.getElementById("fullscreenButton").dispatchEvent(new Event("click")),e=!0),this.inputElement=document.createElement("input"),this.inputElement.type="text",this.inputElement.style.position="absolute";var t=this.hitbox.x,n=this.hitbox.y;if(this.parentComponent){const l=this.parentComponent.getHitbox();t+=l.x,n+=l.y}const r=this.canvas.getBoundingClientRect();this.inputElement.style.left=r.left+t+(r.width-s.CANVAS_WIDTH)/2+"px",this.inputElement.style.top=r.top+n+(r.height-s.CANVAS_HEIGHT)/2+"px",this.inputElement.style.width=this.hitbox.width+"px",this.inputElement.style.height=this.hitbox.height+"px",this.inputElement.style.fontSize=this.fontSize+"px",this.inputElement.style.zIndex="1000",this.inputElement.style.opacity="1.0",this.inputElement.style.pointerEvents="auto",this.inputElement.autocomplete="off",this.inputElement.placeholder=this.placeholder,this.inputElement.value=this.text,this.inputElement.id="textboxCanvas",this.inputElement.focus(),(h=document.getElementById("gameDiv"))==null||h.appendChild(this.inputElement),this.inputElement.focus(),this.boxFocus=!0,this.text="",this.inputElement.value=this.text,this.inputElement.addEventListener("keydown",this.handleKeyDown),this.inputElement.addEventListener("blur",()=>{e&&document.getElementById("fullscreenButton").dispatchEvent(new Event("click"))})}removeTextElement(){var e;this.inputElement&&(this.inputElement.removeEventListener("keydown",this.handleKeyDown),(e=document.getElementById("gameDiv"))==null||e.removeChild(this.inputElement),this.inputElement=void 0)}update(e){super.update(e),this.handleMouseDown()}}class Ue{constructor(e,t){this.socket=null,this.canvas=e,this.chatComponent=t,s.COMMAND_SYSTEM.addCommand("print",n=>{console.log(n.join(" "))}),s.COMMAND_SYSTEM.addCommand("chatui",n=>{const r=this.chatComponent.getHitbox();if(n[0]==="set")n[1]==="hitbox"?this.chatComponent.setHitbox({x:Number(n[2]),y:Number(n[3]),width:Number(n[4]),height:Number(n[5])}):n[1]==="color"&&(n[5]?this.chatComponent.setColor({red:Number(n[2]),green:Number(n[3]),blue:Number(n[4]),alpha:Number(n[5])}):this.chatComponent.setColor({red:Number(n[2]),green:Number(n[3]),blue:Number(n[4])}));else if(n[0]==="changesize"){if(n[1]==="width")if(r.x+Number(n[2])>s.CANVAS_WIDTH){if(s.CANVAS_WIDTH-Number(n[2])<0)return;this.chatComponent.setHitbox({...r,x:s.CANVAS_WIDTH-Number(n[2]),width:Number(n[2])})}else this.chatComponent.setHitbox({...r,width:Number(n[2])});else if(n[1]==="height")if(r.y+Number(n[2])>s.CANVAS_HEIGHT){if(s.CANVAS_HEIGHT-Number(n[2])<0)return;this.chatComponent.setHitbox({...r,y:s.CANVAS_HEIGHT-Number(n[2]),height:Number(n[2])})}else this.chatComponent.setHitbox({...r,height:Number(n[2])})}this.chatbox.setHitbox({x:5,y:5,width:r.width-10,height:r.height*.8-15}),this.textbox.setHitbox({x:5,y:this.chatbox.getHitbox().y+this.chatbox.getHitbox().height+5,width:r.width-10,height:r.height*.2-15})}),this.chatbox=new Q({x:5,y:5,width:this.chatComponent.getHitbox().width-10,height:this.chatComponent.getHitbox().height*.8-15},{red:0,green:255,blue:0},!1,"",{red:0,green:0,blue:255},13,"left",!0),s.COMMAND_SYSTEM.setOutputLabel(this.chatbox),this.textbox=new Be(this.canvas,{x:5,y:this.chatbox.getHitbox().y+this.chatbox.getHitbox().height+5,width:this.chatComponent.getHitbox().width-10,height:this.chatComponent.getHitbox().height*.2-15},{red:0,green:255,blue:0},!1,"",{red:0,green:0,blue:255},9,"left",!0,()=>{if(this.textbox.getText().trim()[0]==="/"){let n=s.COMMAND_SYSTEM.runCommand(this.textbox.getText());n&&this.chatbox.update(this.chatbox.getText()+`
`+n)}else this.addMessage(this.textbox.getText());this.textbox.update("")}),this.chatbox.setParentComponent(this.chatComponent),this.textbox.setParentComponent(this.chatComponent)}render(e){this.chatComponent.render(e),this.chatbox.render(e),this.textbox.render(e)}update(){this.chatbox.update(),this.textbox.update()}setSocket(e){this.socket=e,this.readMessage()}addMessage(e){this.chatbox.update(this.chatbox.getText()+`
YOU: `+e),this.sendMessage(e)}sendMessage(e){this.socket&&this.socket.emit("sendChatMessage",this.serializeMessage(e,"NAME"))}readMessage(){this.socket&&this.socket.on("readChatMesage",e=>{this.chatbox.update(this.chatbox.getText()+`
`+e.name+": "+e.text)})}serializeMessage(e,t){return{name:t,text:e}}hide(){this.chatComponent.hide(),this.chatbox.hide(),this.textbox.hide()}show(){this.chatComponent.show(),this.chatbox.show(),this.textbox.show()}}class Oe{constructor(e,t,n){this.deathMenuComponents=[],this.deathComponent=t,this.player=n,this.initMenu(e)}initMenu(e){const r={red:150,green:150,blue:150,alpha:1},h={red:100,green:100,blue:100,alpha:1},l={red:200,green:200,blue:200,alpha:1};this.deathMenuComponents.push(new Q({x:this.deathComponent.getHitbox().width/2-e.getContext("2d").measureText("YOu DIED").width/2,y:this.deathComponent.getHitbox().height/2-this.deathComponent.getHitbox().height/5,width:e.getContext("2d").measureText("YOu DIED").width,height:32},{red:0,blue:0,green:0,alpha:.001},!0,"YOU DIED",{red:255,blue:255,green:255,alpha:1},8,"center",!1)),this.deathMenuComponents.push(new V(e,{x:this.deathComponent.getHitbox().width/2-120/2,y:this.deathComponent.getHitbox().height/2+this.deathComponent.getHitbox().height/5,width:120,height:40},r,!0,"RESPAWN",{red:255,blue:255,green:255,alpha:1},8,"center",h,{red:255,blue:255,green:255,alpha:1},l,()=>{this.player.getHitboxComponent().setHitbox({...this.player.getHitboxComponent().getHitbox(),x:100,y:100}),this.player.getHealthComponent().heal(this.player.getHealthComponent().getMaxHealth())})),this.deathMenuComponents[0].setParentComponent(this.deathComponent),this.deathMenuComponents[1].setParentComponent(this.deathComponent)}render(e){this.deathComponent.render(e);for(let t=0;t<this.deathMenuComponents.length;t++)this.deathMenuComponents[t].render(e)}update(){for(let e=0;e<this.deathMenuComponents.length;e++)this.deathMenuComponents[e].update()}hide(){this.deathComponent.hide();for(let e=0;e<this.deathMenuComponents.length;e++)this.deathMenuComponents[e].hide()}show(){this.deathComponent.show();for(let e=0;e<this.deathMenuComponents.length;e++)this.deathMenuComponents[e].show()}}class We{constructor(e,t,n,r){this.debugComponent=t,this.camera=r,this.player=n,this.debugInfo=new Q({x:5,y:5,width:this.debugComponent.getHitbox().width-10,height:80},{red:0,green:255,blue:0},!0,"Boo",{red:0,green:0,blue:255},9),this.debugTeleportToCenterButton=new V(e,{x:5,y:90,width:this.debugComponent.getHitbox().width-10,height:20},{red:0,green:255,blue:0},!0,"Teleport Center",{red:0,green:0,blue:255},9,"center",{red:123,green:123,blue:0},void 0,{red:255,green:0,blue:255},()=>{}),this.debugZoomIn=new V(e,{x:5,y:120,width:(this.debugComponent.getHitbox().width-10)/2-10,height:20},{red:0,green:255,blue:0},!0,"Zoom In",{red:0,green:0,blue:255},9,"center",{red:123,green:123,blue:0},void 0,{red:255,green:0,blue:255},()=>{this.camera.setView({...this.camera.getView(),zoom:this.camera.getView().zoom+.25})}),this.debugZoomOut=new V(e,{x:5+(this.debugComponent.getHitbox().width-10)/2+10,y:120,width:(this.debugComponent.getHitbox().width-10)/2-10,height:20},{red:0,green:255,blue:0},!0,"Zoom Out",{red:0,green:0,blue:255},9,"center",{red:123,green:123,blue:0},void 0,{red:255,green:0,blue:255},()=>{this.camera.setView({...this.camera.getView(),zoom:Math.max(this.camera.getView().zoom-.25,.25)})}),this.debugSpeedUp=new V(e,{x:5,y:150,width:(this.debugComponent.getHitbox().width-10)/2-10,height:20},{red:0,green:255,blue:0},!0,"Increase Speed",{red:0,green:0,blue:255},9,"center",{red:123,green:123,blue:0},void 0,{red:255,green:0,blue:255},()=>{this.player.setSpeed(this.player.getSpeed()+15)}),this.debugSpeedDown=new V(e,{x:5+(this.debugComponent.getHitbox().width-10)/2+10,y:150,width:(this.debugComponent.getHitbox().width-10)/2-10,height:20},{red:0,green:255,blue:0},!0,"Decrease Speed",{red:0,green:0,blue:255},9,"center",{red:123,green:123,blue:0},void 0,{red:255,green:0,blue:255},()=>{this.player.setSpeed(this.player.getSpeed()-15)}),this.debugComponent.hide(),this.debugSpeedUp.setParentComponent(this.debugComponent),this.debugSpeedDown.setParentComponent(this.debugComponent),this.debugZoomIn.setParentComponent(this.debugComponent),this.debugZoomOut.setParentComponent(this.debugComponent),this.debugInfo.setParentComponent(this.debugComponent),this.debugTeleportToCenterButton.setParentComponent(this.debugComponent)}render(e){this.debugComponent.render(e),this.debugInfo.render(e),this.debugTeleportToCenterButton.render(e),this.debugZoomIn.render(e),this.debugZoomOut.render(e),this.debugSpeedUp.render(e),this.debugSpeedDown.render(e)}update(){var e,t,n;if(s.INPUT_HANDLER.checkControlToggle(this.player.getControls().debug))this.show();else{this.hide();return}this.debugInfo.update("Player coord: ("+((e=this.player.getHitboxComponent().getHitbox().x)==null?void 0:e.toFixed(0))+", "+((n=(t=this.player)==null?void 0:t.getHitboxComponent().getHitbox().y)==null?void 0:n.toFixed(0))+`)
Player Direction: `+this.player.getDirection()+`
Player Health: `+this.player.getHealthComponent().getHealth()+`
Camera zoom`+this.camera.getView().zoom+`
Player speed: `+this.player.getSpeed()+`
Player Layer: `+this.player.getLayer()),this.debugTeleportToCenterButton.setOnTrue(()=>{this.player.getHitboxComponent().setHitbox({...this.player.getHitboxComponent().getHitbox(),x:480/2,y:320/2})}),this.debugTeleportToCenterButton.update(),this.debugZoomIn.update(),this.debugZoomOut.update(),this.debugSpeedUp.update(),this.debugSpeedDown.update()}hide(){this.debugComponent.hide(),this.debugInfo.hide(),this.debugTeleportToCenterButton.hide(),this.debugZoomIn.hide(),this.debugZoomOut.hide(),this.debugSpeedUp.hide(),this.debugSpeedDown.hide()}show(){this.debugComponent.show(),this.debugInfo.show(),this.debugTeleportToCenterButton.show(),this.debugZoomIn.show(),this.debugZoomOut.show(),this.debugSpeedUp.show(),this.debugSpeedDown.show()}}class Fe extends F{constructor(e,t={red:255,green:0,blue:255,alpha:1},n,r={red:0,green:0,blue:0,alpha:1},h,l=m=>{}){super(e,t,n),this.knobColor=r,this.value=h,this.knobHitbox={x:this.value*this.hitbox.width+this.hitbox.x-10/2,y:e.y-4,width:10,height:e.height+8},this.onChange=l,this.onChange(this.value)}mouseDown(){const e=s.INPUT_HANDLER.getMousePosition();var t=this.hitbox.x,n=this.hitbox.y;if(this.parentComponent&&!this.parentComponent.isHidden()){const r=this.parentComponent.getHitbox();t+=r.x,n+=r.y}if(N(e,{...this.hitbox,x:t-2,y:n,width:this.hitbox.width+4})){let r=(e.x-t)/this.hitbox.width;r=Math.max(0,Math.min(1,r)),this.value!=r&&(this.value=r,this.onChange(this.value)),this.knobHitbox.x=t+this.value*this.hitbox.width-this.knobHitbox.width/2}}update(e){s.INPUT_HANDLER.isLeftDown()&&this.mouseDown()}render(e){this.hidden||(super.render(e),this.knobColor.alpha?e.fillStyle="rgba("+this.knobColor.red+","+this.knobColor.green+","+this.knobColor.blue+", "+this.knobColor.alpha+")":e.fillStyle="rgb("+this.knobColor.red+","+this.knobColor.green+","+this.knobColor.blue+")",this.knobHitbox,this.parentComponent?e.fillRect(this.knobHitbox.x,this.knobHitbox.y+this.parentComponent.getHitbox().y,this.knobHitbox.width,this.knobHitbox.height):e.fillRect(this.knobHitbox.x,this.knobHitbox.y,this.knobHitbox.width,this.knobHitbox.height))}getValue(){return console.log(this.value),this.value}}var ie=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ge(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}var pe={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var _e;function Ke(){return _e||(_e=1,function(_){(function(){var e=function(){this.init()};e.prototype={init:function(){var i=this||t;return i._counter=1e3,i._html5AudioPool=[],i.html5PoolSize=10,i._codecs={},i._howls=[],i._muted=!1,i._volume=1,i._canPlayEvent="canplaythrough",i._navigator=typeof window<"u"&&window.navigator?window.navigator:null,i.masterGain=null,i.noAudio=!1,i.usingWebAudio=!0,i.autoSuspend=!0,i.ctx=null,i.autoUnlock=!0,i._setup(),i},volume:function(i){var o=this||t;if(i=parseFloat(i),o.ctx||I(),typeof i<"u"&&i>=0&&i<=1){if(o._volume=i,o._muted)return o;o.usingWebAudio&&o.masterGain.gain.setValueAtTime(i,t.ctx.currentTime);for(var a=0;a<o._howls.length;a++)if(!o._howls[a]._webAudio)for(var d=o._howls[a]._getSoundIds(),f=0;f<d.length;f++){var g=o._howls[a]._soundById(d[f]);g&&g._node&&(g._node.volume=g._volume*i)}return o}return o._volume},mute:function(i){var o=this||t;o.ctx||I(),o._muted=i,o.usingWebAudio&&o.masterGain.gain.setValueAtTime(i?0:o._volume,t.ctx.currentTime);for(var a=0;a<o._howls.length;a++)if(!o._howls[a]._webAudio)for(var d=o._howls[a]._getSoundIds(),f=0;f<d.length;f++){var g=o._howls[a]._soundById(d[f]);g&&g._node&&(g._node.muted=i?!0:g._muted)}return o},stop:function(){for(var i=this||t,o=0;o<i._howls.length;o++)i._howls[o].stop();return i},unload:function(){for(var i=this||t,o=i._howls.length-1;o>=0;o--)i._howls[o].unload();return i.usingWebAudio&&i.ctx&&typeof i.ctx.close<"u"&&(i.ctx.close(),i.ctx=null,I()),i},codecs:function(i){return(this||t)._codecs[i.replace(/^x-/,"")]},_setup:function(){var i=this||t;if(i.state=i.ctx&&i.ctx.state||"suspended",i._autoSuspend(),!i.usingWebAudio)if(typeof Audio<"u")try{var o=new Audio;typeof o.oncanplaythrough>"u"&&(i._canPlayEvent="canplay")}catch{i.noAudio=!0}else i.noAudio=!0;try{var o=new Audio;o.muted&&(i.noAudio=!0)}catch{}return i.noAudio||i._setupCodecs(),i},_setupCodecs:function(){var i=this||t,o=null;try{o=typeof Audio<"u"?new Audio:null}catch{return i}if(!o||typeof o.canPlayType!="function")return i;var a=o.canPlayType("audio/mpeg;").replace(/^no$/,""),d=i._navigator?i._navigator.userAgent:"",f=d.match(/OPR\/(\d+)/g),g=f&&parseInt(f[0].split("/")[1],10)<33,u=d.indexOf("Safari")!==-1&&d.indexOf("Chrome")===-1,y=d.match(/Version\/(.*?) /),b=u&&y&&parseInt(y[1],10)<15;return i._codecs={mp3:!!(!g&&(a||o.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!a,opus:!!o.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!o.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(o.canPlayType('audio/wav; codecs="1"')||o.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!o.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!o.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(o.canPlayType("audio/x-m4a;")||o.canPlayType("audio/m4a;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(o.canPlayType("audio/x-m4b;")||o.canPlayType("audio/m4b;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(o.canPlayType("audio/x-mp4;")||o.canPlayType("audio/mp4;")||o.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!b&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!b&&o.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!o.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(o.canPlayType("audio/x-flac;")||o.canPlayType("audio/flac;")).replace(/^no$/,"")},i},_unlockAudio:function(){var i=this||t;if(!(i._audioUnlocked||!i.ctx)){i._audioUnlocked=!1,i.autoUnlock=!1,!i._mobileUnloaded&&i.ctx.sampleRate!==44100&&(i._mobileUnloaded=!0,i.unload()),i._scratchBuffer=i.ctx.createBuffer(1,1,22050);var o=function(a){for(;i._html5AudioPool.length<i.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,i._releaseHtml5Audio(d)}catch{i.noAudio=!0;break}for(var f=0;f<i._howls.length;f++)if(!i._howls[f]._webAudio)for(var g=i._howls[f]._getSoundIds(),u=0;u<g.length;u++){var y=i._howls[f]._soundById(g[u]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}i._autoResume();var b=i.ctx.createBufferSource();b.buffer=i._scratchBuffer,b.connect(i.ctx.destination),typeof b.start>"u"?b.noteOn(0):b.start(0),typeof i.ctx.resume=="function"&&i.ctx.resume(),b.onended=function(){b.disconnect(0),i._audioUnlocked=!0,document.removeEventListener("touchstart",o,!0),document.removeEventListener("touchend",o,!0),document.removeEventListener("click",o,!0),document.removeEventListener("keydown",o,!0);for(var T=0;T<i._howls.length;T++)i._howls[T]._emit("unlock")}};return document.addEventListener("touchstart",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("click",o,!0),document.addEventListener("keydown",o,!0),i}},_obtainHtml5Audio:function(){var i=this||t;if(i._html5AudioPool.length)return i._html5AudioPool.pop();var o=new Audio().play();return o&&typeof Promise<"u"&&(o instanceof Promise||typeof o.then=="function")&&o.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(i){var o=this||t;return i._unlocked&&o._html5AudioPool.push(i),o},_autoSuspend:function(){var i=this;if(!(!i.autoSuspend||!i.ctx||typeof i.ctx.suspend>"u"||!t.usingWebAudio)){for(var o=0;o<i._howls.length;o++)if(i._howls[o]._webAudio){for(var a=0;a<i._howls[o]._sounds.length;a++)if(!i._howls[o]._sounds[a]._paused)return i}return i._suspendTimer&&clearTimeout(i._suspendTimer),i._suspendTimer=setTimeout(function(){if(i.autoSuspend){i._suspendTimer=null,i.state="suspending";var d=function(){i.state="suspended",i._resumeAfterSuspend&&(delete i._resumeAfterSuspend,i._autoResume())};i.ctx.suspend().then(d,d)}},3e4),i}},_autoResume:function(){var i=this;if(!(!i.ctx||typeof i.ctx.resume>"u"||!t.usingWebAudio))return i.state==="running"&&i.ctx.state!=="interrupted"&&i._suspendTimer?(clearTimeout(i._suspendTimer),i._suspendTimer=null):i.state==="suspended"||i.state==="running"&&i.ctx.state==="interrupted"?(i.ctx.resume().then(function(){i.state="running";for(var o=0;o<i._howls.length;o++)i._howls[o]._emit("resume")}),i._suspendTimer&&(clearTimeout(i._suspendTimer),i._suspendTimer=null)):i.state==="suspending"&&(i._resumeAfterSuspend=!0),i}};var t=new e,n=function(i){var o=this;if(!i.src||i.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}o.init(i)};n.prototype={init:function(i){var o=this;return t.ctx||I(),o._autoplay=i.autoplay||!1,o._format=typeof i.format!="string"?i.format:[i.format],o._html5=i.html5||!1,o._muted=i.mute||!1,o._loop=i.loop||!1,o._pool=i.pool||5,o._preload=typeof i.preload=="boolean"||i.preload==="metadata"?i.preload:!0,o._rate=i.rate||1,o._sprite=i.sprite||{},o._src=typeof i.src!="string"?i.src:[i.src],o._volume=i.volume!==void 0?i.volume:1,o._xhr={method:i.xhr&&i.xhr.method?i.xhr.method:"GET",headers:i.xhr&&i.xhr.headers?i.xhr.headers:null,withCredentials:i.xhr&&i.xhr.withCredentials?i.xhr.withCredentials:!1},o._duration=0,o._state="unloaded",o._sounds=[],o._endTimers={},o._queue=[],o._playLock=!1,o._onend=i.onend?[{fn:i.onend}]:[],o._onfade=i.onfade?[{fn:i.onfade}]:[],o._onload=i.onload?[{fn:i.onload}]:[],o._onloaderror=i.onloaderror?[{fn:i.onloaderror}]:[],o._onplayerror=i.onplayerror?[{fn:i.onplayerror}]:[],o._onpause=i.onpause?[{fn:i.onpause}]:[],o._onplay=i.onplay?[{fn:i.onplay}]:[],o._onstop=i.onstop?[{fn:i.onstop}]:[],o._onmute=i.onmute?[{fn:i.onmute}]:[],o._onvolume=i.onvolume?[{fn:i.onvolume}]:[],o._onrate=i.onrate?[{fn:i.onrate}]:[],o._onseek=i.onseek?[{fn:i.onseek}]:[],o._onunlock=i.onunlock?[{fn:i.onunlock}]:[],o._onresume=[],o._webAudio=t.usingWebAudio&&!o._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(o),o._autoplay&&o._queue.push({event:"play",action:function(){o.play()}}),o._preload&&o._preload!=="none"&&o.load(),o},load:function(){var i=this,o=null;if(t.noAudio){i._emit("loaderror",null,"No audio support.");return}typeof i._src=="string"&&(i._src=[i._src]);for(var a=0;a<i._src.length;a++){var d,f;if(i._format&&i._format[a])d=i._format[a];else{if(f=i._src[a],typeof f!="string"){i._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}d=/^data:audio\/([^;,]+);/i.exec(f),d||(d=/\.([^.]+)$/.exec(f.split("?",1)[0])),d&&(d=d[1].toLowerCase())}if(d||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),d&&t.codecs(d)){o=i._src[a];break}}if(!o){i._emit("loaderror",null,"No codec support for selected audio sources.");return}return i._src=o,i._state="loading",window.location.protocol==="https:"&&o.slice(0,5)==="http:"&&(i._html5=!0,i._webAudio=!1),new r(i),i._webAudio&&l(i),i},play:function(i,o){var a=this,d=null;if(typeof i=="number")d=i,i=null;else{if(typeof i=="string"&&a._state==="loaded"&&!a._sprite[i])return null;if(typeof i>"u"&&(i="__default",!a._playLock)){for(var f=0,g=0;g<a._sounds.length;g++)a._sounds[g]._paused&&!a._sounds[g]._ended&&(f++,d=a._sounds[g]._id);f===1?i=null:d=null}}var u=d?a._soundById(d):a._inactiveSound();if(!u)return null;if(d&&!i&&(i=u._sprite||"__default"),a._state!=="loaded"){u._sprite=i,u._ended=!1;var y=u._id;return a._queue.push({event:"play",action:function(){a.play(y)}}),y}if(d&&!u._paused)return o||a._loadQueue("play"),u._id;a._webAudio&&t._autoResume();var b=Math.max(0,u._seek>0?u._seek:a._sprite[i][0]/1e3),T=Math.max(0,(a._sprite[i][0]+a._sprite[i][1])/1e3-b),A=T*1e3/Math.abs(u._rate),L=a._sprite[i][0]/1e3,C=(a._sprite[i][0]+a._sprite[i][1])/1e3;u._sprite=i,u._ended=!1;var j=function(){u._paused=!1,u._seek=b,u._start=L,u._stop=C,u._loop=!!(u._loop||a._sprite[i][2])};if(b>=C){a._ended(u);return}var S=u._node;if(a._webAudio){var Y=function(){a._playLock=!1,j(),a._refreshBuffer(u);var D=u._muted||a._muted?0:u._volume;S.gain.setValueAtTime(D,t.ctx.currentTime),u._playStart=t.ctx.currentTime,typeof S.bufferSource.start>"u"?u._loop?S.bufferSource.noteGrainOn(0,b,86400):S.bufferSource.noteGrainOn(0,b,T):u._loop?S.bufferSource.start(0,b,86400):S.bufferSource.start(0,b,T),A!==1/0&&(a._endTimers[u._id]=setTimeout(a._ended.bind(a,u),A)),o||setTimeout(function(){a._emit("play",u._id),a._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?Y():(a._playLock=!0,a.once("resume",Y),a._clearTimer(u._id))}else{var X=function(){S.currentTime=b,S.muted=u._muted||a._muted||t._muted||S.muted,S.volume=u._volume*t.volume(),S.playbackRate=u._rate;try{var D=S.play();if(D&&typeof Promise<"u"&&(D instanceof Promise||typeof D.then=="function")?(a._playLock=!0,j(),D.then(function(){a._playLock=!1,S._unlocked=!0,o?a._loadQueue():a._emit("play",u._id)}).catch(function(){a._playLock=!1,a._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),u._ended=!0,u._paused=!0})):o||(a._playLock=!1,j(),a._emit("play",u._id)),S.playbackRate=u._rate,S.paused){a._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}i!=="__default"||u._loop?a._endTimers[u._id]=setTimeout(a._ended.bind(a,u),A):(a._endTimers[u._id]=function(){a._ended(u),S.removeEventListener("ended",a._endTimers[u._id],!1)},S.addEventListener("ended",a._endTimers[u._id],!1))}catch($){a._emit("playerror",u._id,$)}};S.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(S.src=a._src,S.load());var q=window&&window.ejecta||!S.readyState&&t._navigator.isCocoonJS;if(S.readyState>=3||q)X();else{a._playLock=!0,a._state="loading";var B=function(){a._state="loaded",X(),S.removeEventListener(t._canPlayEvent,B,!1)};S.addEventListener(t._canPlayEvent,B,!1),a._clearTimer(u._id)}}return u._id},pause:function(i){var o=this;if(o._state!=="loaded"||o._playLock)return o._queue.push({event:"pause",action:function(){o.pause(i)}}),o;for(var a=o._getSoundIds(i),d=0;d<a.length;d++){o._clearTimer(a[d]);var f=o._soundById(a[d]);if(f&&!f._paused&&(f._seek=o.seek(a[d]),f._rateSeek=0,f._paused=!0,o._stopFade(a[d]),f._node))if(o._webAudio){if(!f._node.bufferSource)continue;typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),o._cleanBuffer(f._node)}else(!isNaN(f._node.duration)||f._node.duration===1/0)&&f._node.pause();arguments[1]||o._emit("pause",f?f._id:null)}return o},stop:function(i,o){var a=this;if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"stop",action:function(){a.stop(i)}}),a;for(var d=a._getSoundIds(i),f=0;f<d.length;f++){a._clearTimer(d[f]);var g=a._soundById(d[f]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,a._stopFade(d[f]),g._node&&(a._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),a._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&a._clearSound(g._node))),o||a._emit("stop",g._id))}return a},mute:function(i,o){var a=this;if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"mute",action:function(){a.mute(i,o)}}),a;if(typeof o>"u")if(typeof i=="boolean")a._muted=i;else return a._muted;for(var d=a._getSoundIds(o),f=0;f<d.length;f++){var g=a._soundById(d[f]);g&&(g._muted=i,g._interval&&a._stopFade(g._id),a._webAudio&&g._node?g._node.gain.setValueAtTime(i?0:g._volume,t.ctx.currentTime):g._node&&(g._node.muted=t._muted?!0:i),a._emit("mute",g._id))}return a},volume:function(){var i=this,o=arguments,a,d;if(o.length===0)return i._volume;if(o.length===1||o.length===2&&typeof o[1]>"u"){var f=i._getSoundIds(),g=f.indexOf(o[0]);g>=0?d=parseInt(o[0],10):a=parseFloat(o[0])}else o.length>=2&&(a=parseFloat(o[0]),d=parseInt(o[1],10));var u;if(typeof a<"u"&&a>=0&&a<=1){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,o)}}),i;typeof d>"u"&&(i._volume=a),d=i._getSoundIds(d);for(var y=0;y<d.length;y++)u=i._soundById(d[y]),u&&(u._volume=a,o[2]||i._stopFade(d[y]),i._webAudio&&u._node&&!u._muted?u._node.gain.setValueAtTime(a,t.ctx.currentTime):u._node&&!u._muted&&(u._node.volume=a*t.volume()),i._emit("volume",u._id))}else return u=d?i._soundById(d):i._sounds[0],u?u._volume:0;return i},fade:function(i,o,a,d){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"fade",action:function(){f.fade(i,o,a,d)}}),f;i=Math.min(Math.max(0,parseFloat(i)),1),o=Math.min(Math.max(0,parseFloat(o)),1),a=parseFloat(a),f.volume(i,d);for(var g=f._getSoundIds(d),u=0;u<g.length;u++){var y=f._soundById(g[u]);if(y){if(d||f._stopFade(g[u]),f._webAudio&&!y._muted){var b=t.ctx.currentTime,T=b+a/1e3;y._volume=i,y._node.gain.setValueAtTime(i,b),y._node.gain.linearRampToValueAtTime(o,T)}f._startFadeInterval(y,i,o,a,g[u],typeof d>"u")}}return f},_startFadeInterval:function(i,o,a,d,f,g){var u=this,y=o,b=a-o,T=Math.abs(b/.01),A=Math.max(4,T>0?d/T:d),L=Date.now();i._fadeTo=a,i._interval=setInterval(function(){var C=(Date.now()-L)/d;L=Date.now(),y+=b*C,y=Math.round(y*100)/100,b<0?y=Math.max(a,y):y=Math.min(a,y),u._webAudio?i._volume=y:u.volume(y,i._id,!0),g&&(u._volume=y),(a<o&&y<=a||a>o&&y>=a)&&(clearInterval(i._interval),i._interval=null,i._fadeTo=null,u.volume(a,i._id),u._emit("fade",i._id))},A)},_stopFade:function(i){var o=this,a=o._soundById(i);return a&&a._interval&&(o._webAudio&&a._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(a._interval),a._interval=null,o.volume(a._fadeTo,i),a._fadeTo=null,o._emit("fade",i)),o},loop:function(){var i=this,o=arguments,a,d,f;if(o.length===0)return i._loop;if(o.length===1)if(typeof o[0]=="boolean")a=o[0],i._loop=a;else return f=i._soundById(parseInt(o[0],10)),f?f._loop:!1;else o.length===2&&(a=o[0],d=parseInt(o[1],10));for(var g=i._getSoundIds(d),u=0;u<g.length;u++)f=i._soundById(g[u]),f&&(f._loop=a,i._webAudio&&f._node&&f._node.bufferSource&&(f._node.bufferSource.loop=a,a&&(f._node.bufferSource.loopStart=f._start||0,f._node.bufferSource.loopEnd=f._stop,i.playing(g[u])&&(i.pause(g[u],!0),i.play(g[u],!0)))));return i},rate:function(){var i=this,o=arguments,a,d;if(o.length===0)d=i._sounds[0]._id;else if(o.length===1){var f=i._getSoundIds(),g=f.indexOf(o[0]);g>=0?d=parseInt(o[0],10):a=parseFloat(o[0])}else o.length===2&&(a=parseFloat(o[0]),d=parseInt(o[1],10));var u;if(typeof a=="number"){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,o)}}),i;typeof d>"u"&&(i._rate=a),d=i._getSoundIds(d);for(var y=0;y<d.length;y++)if(u=i._soundById(d[y]),u){i.playing(d[y])&&(u._rateSeek=i.seek(d[y]),u._playStart=i._webAudio?t.ctx.currentTime:u._playStart),u._rate=a,i._webAudio&&u._node&&u._node.bufferSource?u._node.bufferSource.playbackRate.setValueAtTime(a,t.ctx.currentTime):u._node&&(u._node.playbackRate=a);var b=i.seek(d[y]),T=(i._sprite[u._sprite][0]+i._sprite[u._sprite][1])/1e3-b,A=T*1e3/Math.abs(u._rate);(i._endTimers[d[y]]||!u._paused)&&(i._clearTimer(d[y]),i._endTimers[d[y]]=setTimeout(i._ended.bind(i,u),A)),i._emit("rate",u._id)}}else return u=i._soundById(d),u?u._rate:i._rate;return i},seek:function(){var i=this,o=arguments,a,d;if(o.length===0)i._sounds.length&&(d=i._sounds[0]._id);else if(o.length===1){var f=i._getSoundIds(),g=f.indexOf(o[0]);g>=0?d=parseInt(o[0],10):i._sounds.length&&(d=i._sounds[0]._id,a=parseFloat(o[0]))}else o.length===2&&(a=parseFloat(o[0]),d=parseInt(o[1],10));if(typeof d>"u")return 0;if(typeof a=="number"&&(i._state!=="loaded"||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,o)}}),i;var u=i._soundById(d);if(u)if(typeof a=="number"&&a>=0){var y=i.playing(d);y&&i.pause(d,!0),u._seek=a,u._ended=!1,i._clearTimer(d),!i._webAudio&&u._node&&!isNaN(u._node.duration)&&(u._node.currentTime=a);var b=function(){y&&i.play(d,!0),i._emit("seek",d)};if(y&&!i._webAudio){var T=function(){i._playLock?setTimeout(T,0):b()};setTimeout(T,0)}else b()}else if(i._webAudio){var A=i.playing(d)?t.ctx.currentTime-u._playStart:0,L=u._rateSeek?u._rateSeek-u._seek:0;return u._seek+(L+A*Math.abs(u._rate))}else return u._node.currentTime;return i},playing:function(i){var o=this;if(typeof i=="number"){var a=o._soundById(i);return a?!a._paused:!1}for(var d=0;d<o._sounds.length;d++)if(!o._sounds[d]._paused)return!0;return!1},duration:function(i){var o=this,a=o._duration,d=o._soundById(i);return d&&(a=o._sprite[d._sprite][1]/1e3),a},state:function(){return this._state},unload:function(){for(var i=this,o=i._sounds,a=0;a<o.length;a++)o[a]._paused||i.stop(o[a]._id),i._webAudio||(i._clearSound(o[a]._node),o[a]._node.removeEventListener("error",o[a]._errorFn,!1),o[a]._node.removeEventListener(t._canPlayEvent,o[a]._loadFn,!1),o[a]._node.removeEventListener("ended",o[a]._endFn,!1),t._releaseHtml5Audio(o[a]._node)),delete o[a]._node,i._clearTimer(o[a]._id);var d=t._howls.indexOf(i);d>=0&&t._howls.splice(d,1);var f=!0;for(a=0;a<t._howls.length;a++)if(t._howls[a]._src===i._src||i._src.indexOf(t._howls[a]._src)>=0){f=!1;break}return h&&f&&delete h[i._src],t.noAudio=!1,i._state="unloaded",i._sounds=[],i=null,null},on:function(i,o,a,d){var f=this,g=f["_on"+i];return typeof o=="function"&&g.push(d?{id:a,fn:o,once:d}:{id:a,fn:o}),f},off:function(i,o,a){var d=this,f=d["_on"+i],g=0;if(typeof o=="number"&&(a=o,o=null),o||a)for(g=0;g<f.length;g++){var u=a===f[g].id;if(o===f[g].fn&&u||!o&&u){f.splice(g,1);break}}else if(i)d["_on"+i]=[];else{var y=Object.keys(d);for(g=0;g<y.length;g++)y[g].indexOf("_on")===0&&Array.isArray(d[y[g]])&&(d[y[g]]=[])}return d},once:function(i,o,a){var d=this;return d.on(i,o,a,1),d},_emit:function(i,o,a){for(var d=this,f=d["_on"+i],g=f.length-1;g>=0;g--)(!f[g].id||f[g].id===o||i==="load")&&(setTimeout((function(u){u.call(this,o,a)}).bind(d,f[g].fn),0),f[g].once&&d.off(i,f[g].fn,f[g].id));return d._loadQueue(i),d},_loadQueue:function(i){var o=this;if(o._queue.length>0){var a=o._queue[0];a.event===i&&(o._queue.shift(),o._loadQueue()),i||a.action()}return o},_ended:function(i){var o=this,a=i._sprite;if(!o._webAudio&&i._node&&!i._node.paused&&!i._node.ended&&i._node.currentTime<i._stop)return setTimeout(o._ended.bind(o,i),100),o;var d=!!(i._loop||o._sprite[a][2]);if(o._emit("end",i._id),!o._webAudio&&d&&o.stop(i._id,!0).play(i._id),o._webAudio&&d){o._emit("play",i._id),i._seek=i._start||0,i._rateSeek=0,i._playStart=t.ctx.currentTime;var f=(i._stop-i._start)*1e3/Math.abs(i._rate);o._endTimers[i._id]=setTimeout(o._ended.bind(o,i),f)}return o._webAudio&&!d&&(i._paused=!0,i._ended=!0,i._seek=i._start||0,i._rateSeek=0,o._clearTimer(i._id),o._cleanBuffer(i._node),t._autoSuspend()),!o._webAudio&&!d&&o.stop(i._id,!0),o},_clearTimer:function(i){var o=this;if(o._endTimers[i]){if(typeof o._endTimers[i]!="function")clearTimeout(o._endTimers[i]);else{var a=o._soundById(i);a&&a._node&&a._node.removeEventListener("ended",o._endTimers[i],!1)}delete o._endTimers[i]}return o},_soundById:function(i){for(var o=this,a=0;a<o._sounds.length;a++)if(i===o._sounds[a]._id)return o._sounds[a];return null},_inactiveSound:function(){var i=this;i._drain();for(var o=0;o<i._sounds.length;o++)if(i._sounds[o]._ended)return i._sounds[o].reset();return new r(i)},_drain:function(){var i=this,o=i._pool,a=0,d=0;if(!(i._sounds.length<o)){for(d=0;d<i._sounds.length;d++)i._sounds[d]._ended&&a++;for(d=i._sounds.length-1;d>=0;d--){if(a<=o)return;i._sounds[d]._ended&&(i._webAudio&&i._sounds[d]._node&&i._sounds[d]._node.disconnect(0),i._sounds.splice(d,1),a--)}}},_getSoundIds:function(i){var o=this;if(typeof i>"u"){for(var a=[],d=0;d<o._sounds.length;d++)a.push(o._sounds[d]._id);return a}else return[i]},_refreshBuffer:function(i){var o=this;return i._node.bufferSource=t.ctx.createBufferSource(),i._node.bufferSource.buffer=h[o._src],i._panner?i._node.bufferSource.connect(i._panner):i._node.bufferSource.connect(i._node),i._node.bufferSource.loop=i._loop,i._loop&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop||0),i._node.bufferSource.playbackRate.setValueAtTime(i._rate,t.ctx.currentTime),o},_cleanBuffer:function(i){var o=this,a=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!i.bufferSource)return o;if(t._scratchBuffer&&i.bufferSource&&(i.bufferSource.onended=null,i.bufferSource.disconnect(0),a))try{i.bufferSource.buffer=t._scratchBuffer}catch{}return i.bufferSource=null,o},_clearSound:function(i){var o=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);o||(i.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(i){this._parent=i,this.init()};r.prototype={init:function(){var i=this,o=i._parent;return i._muted=o._muted,i._loop=o._loop,i._volume=o._volume,i._rate=o._rate,i._seek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++t._counter,o._sounds.push(i),i.create(),i},create:function(){var i=this,o=i._parent,a=t._muted||i._muted||i._parent._muted?0:i._volume;return o._webAudio?(i._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),i._node.gain.setValueAtTime(a,t.ctx.currentTime),i._node.paused=!0,i._node.connect(t.masterGain)):t.noAudio||(i._node=t._obtainHtml5Audio(),i._errorFn=i._errorListener.bind(i),i._node.addEventListener("error",i._errorFn,!1),i._loadFn=i._loadListener.bind(i),i._node.addEventListener(t._canPlayEvent,i._loadFn,!1),i._endFn=i._endListener.bind(i),i._node.addEventListener("ended",i._endFn,!1),i._node.src=o._src,i._node.preload=o._preload===!0?"auto":o._preload,i._node.volume=a*t.volume(),i._node.load()),i},reset:function(){var i=this,o=i._parent;return i._muted=o._muted,i._loop=o._loop,i._volume=o._volume,i._rate=o._rate,i._seek=0,i._rateSeek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++t._counter,i},_errorListener:function(){var i=this;i._parent._emit("loaderror",i._id,i._node.error?i._node.error.code:0),i._node.removeEventListener("error",i._errorFn,!1)},_loadListener:function(){var i=this,o=i._parent;o._duration=Math.ceil(i._node.duration*10)/10,Object.keys(o._sprite).length===0&&(o._sprite={__default:[0,o._duration*1e3]}),o._state!=="loaded"&&(o._state="loaded",o._emit("load"),o._loadQueue()),i._node.removeEventListener(t._canPlayEvent,i._loadFn,!1)},_endListener:function(){var i=this,o=i._parent;o._duration===1/0&&(o._duration=Math.ceil(i._node.duration*10)/10,o._sprite.__default[1]===1/0&&(o._sprite.__default[1]=o._duration*1e3),o._ended(i)),i._node.removeEventListener("ended",i._endFn,!1)}};var h={},l=function(i){var o=i._src;if(h[o]){i._duration=h[o].duration,p(i);return}if(/^data:[^;]+;base64,/.test(o)){for(var a=atob(o.split(",")[1]),d=new Uint8Array(a.length),f=0;f<a.length;++f)d[f]=a.charCodeAt(f);c(d.buffer,i)}else{var g=new XMLHttpRequest;g.open(i._xhr.method,o,!0),g.withCredentials=i._xhr.withCredentials,g.responseType="arraybuffer",i._xhr.headers&&Object.keys(i._xhr.headers).forEach(function(u){g.setRequestHeader(u,i._xhr.headers[u])}),g.onload=function(){var u=(g.status+"")[0];if(u!=="0"&&u!=="2"&&u!=="3"){i._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}c(g.response,i)},g.onerror=function(){i._webAudio&&(i._html5=!0,i._webAudio=!1,i._sounds=[],delete h[o],i.load())},m(g)}},m=function(i){try{i.send()}catch{i.onerror()}},c=function(i,o){var a=function(){o._emit("loaderror",null,"Decoding audio data failed.")},d=function(f){f&&o._sounds.length>0?(h[o._src]=f,p(o,f)):a()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(i).then(d).catch(a):t.ctx.decodeAudioData(i,d,a)},p=function(i,o){o&&!i._duration&&(i._duration=o.duration),Object.keys(i._sprite).length===0&&(i._sprite={__default:[0,i._duration*1e3]}),i._state!=="loaded"&&(i._state="loaded",i._emit("load"),i._loadQueue())},I=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var i=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),o=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),a=o?parseInt(o[1],10):null;if(i&&a&&a<9){var d=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!d&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};_.Howler=t,_.Howl=n,typeof ie<"u"?(ie.HowlerGlobal=e,ie.Howler=t,ie.Howl=n,ie.Sound=r):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=r)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var r=n._howls.length-1;r>=0;r--)n._howls[r].stereo(t);return n},HowlerGlobal.prototype.pos=function(t,n,r){var h=this;if(!h.ctx||!h.ctx.listener)return h;if(n=typeof n!="number"?h._pos[1]:n,r=typeof r!="number"?h._pos[2]:r,typeof t=="number")h._pos=[t,n,r],typeof h.ctx.listener.positionX<"u"?(h.ctx.listener.positionX.setTargetAtTime(h._pos[0],Howler.ctx.currentTime,.1),h.ctx.listener.positionY.setTargetAtTime(h._pos[1],Howler.ctx.currentTime,.1),h.ctx.listener.positionZ.setTargetAtTime(h._pos[2],Howler.ctx.currentTime,.1)):h.ctx.listener.setPosition(h._pos[0],h._pos[1],h._pos[2]);else return h._pos;return h},HowlerGlobal.prototype.orientation=function(t,n,r,h,l,m){var c=this;if(!c.ctx||!c.ctx.listener)return c;var p=c._orientation;if(n=typeof n!="number"?p[1]:n,r=typeof r!="number"?p[2]:r,h=typeof h!="number"?p[3]:h,l=typeof l!="number"?p[4]:l,m=typeof m!="number"?p[5]:m,typeof t=="number")c._orientation=[t,n,r,h,l,m],typeof c.ctx.listener.forwardX<"u"?(c.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),c.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),c.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),c.ctx.listener.upX.setTargetAtTime(h,Howler.ctx.currentTime,.1),c.ctx.listener.upY.setTargetAtTime(l,Howler.ctx.currentTime,.1),c.ctx.listener.upZ.setTargetAtTime(m,Howler.ctx.currentTime,.1)):c.ctx.listener.setOrientation(t,n,r,h,l,m);else return p;return c},Howl.prototype.init=function(t){return function(n){var r=this;return r._orientation=n.orientation||[1,0,0],r._stereo=n.stereo||null,r._pos=n.pos||null,r._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},r._onstereo=n.onstereo?[{fn:n.onstereo}]:[],r._onpos=n.onpos?[{fn:n.onpos}]:[],r._onorientation=n.onorientation?[{fn:n.onorientation}]:[],t.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,n){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(t,n)}}),r;var h=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof t=="number")r._stereo=t,r._pos=[t,0,0];else return r._stereo;for(var l=r._getSoundIds(n),m=0;m<l.length;m++){var c=r._soundById(l[m]);if(c)if(typeof t=="number")c._stereo=t,c._pos=[t,0,0],c._node&&(c._pannerAttr.panningModel="equalpower",(!c._panner||!c._panner.pan)&&e(c,h),h==="spatial"?typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):c._panner.setPosition(t,0,0):c._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),r._emit("stereo",c._id);else return c._stereo}return r},Howl.prototype.pos=function(t,n,r,h){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"pos",action:function(){l.pos(t,n,r,h)}}),l;if(n=typeof n!="number"?0:n,r=typeof r!="number"?-.5:r,typeof h>"u")if(typeof t=="number")l._pos=[t,n,r];else return l._pos;for(var m=l._getSoundIds(h),c=0;c<m.length;c++){var p=l._soundById(m[c]);if(p)if(typeof t=="number")p._pos=[t,n,r],p._node&&((!p._panner||p._panner.pan)&&e(p,"spatial"),typeof p._panner.positionX<"u"?(p._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):p._panner.setPosition(t,n,r)),l._emit("pos",p._id);else return p._pos}return l},Howl.prototype.orientation=function(t,n,r,h){var l=this;if(!l._webAudio)return l;if(l._state!=="loaded")return l._queue.push({event:"orientation",action:function(){l.orientation(t,n,r,h)}}),l;if(n=typeof n!="number"?l._orientation[1]:n,r=typeof r!="number"?l._orientation[2]:r,typeof h>"u")if(typeof t=="number")l._orientation=[t,n,r];else return l._orientation;for(var m=l._getSoundIds(h),c=0;c<m.length;c++){var p=l._soundById(m[c]);if(p)if(typeof t=="number")p._orientation=[t,n,r],p._node&&(p._panner||(p._pos||(p._pos=l._pos||[0,0,-.5]),e(p,"spatial")),typeof p._panner.orientationX<"u"?(p._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),p._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),p._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):p._panner.setOrientation(t,n,r)),l._emit("orientation",p._id);else return p._orientation}return l},Howl.prototype.pannerAttr=function(){var t=this,n=arguments,r,h,l;if(!t._webAudio)return t;if(n.length===0)return t._pannerAttr;if(n.length===1)if(typeof n[0]=="object")r=n[0],typeof h>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),t._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:t._panningModel});else return l=t._soundById(parseInt(n[0],10)),l?l._pannerAttr:t._pannerAttr;else n.length===2&&(r=n[0],h=parseInt(n[1],10));for(var m=t._getSoundIds(h),c=0;c<m.length;c++)if(l=t._soundById(m[c]),l){var p=l._pannerAttr;p={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:p.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:p.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:p.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:p.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:p.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:p.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:p.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:p.panningModel};var I=l._panner;I||(l._pos||(l._pos=t._pos||[0,0,-.5]),e(l,"spatial"),I=l._panner),I.coneInnerAngle=p.coneInnerAngle,I.coneOuterAngle=p.coneOuterAngle,I.coneOuterGain=p.coneOuterGain,I.distanceModel=p.distanceModel,I.maxDistance=p.maxDistance,I.refDistance=p.refDistance,I.rolloffFactor=p.rolloffFactor,I.panningModel=p.panningModel}return t},Sound.prototype.init=function(t){return function(){var n=this,r=n._parent;n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,t.call(this),n._stereo?r.stereo(n._stereo):n._pos&&r.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var n=this,r=n._parent;return n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,n._stereo?r.stereo(n._stereo):n._pos?r.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,r._refreshBuffer(n)),t.call(this)}}(Sound.prototype.reset);var e=function(t,n){n=n||"spatial",n==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()}(pe)),pe}var Ye=Ke(),Z=(_=>(_.PICKUP="pickup",_.BREAKING_0="breaking0",_.FINISH_BREKAING_0="finishbreaking0",_.PLACE="place",_))(Z||{}),oe=(_=>(_.MUSIC0="music0",_.LIVING="living",_))(oe||{});const ce=class ce{static init(){this.loadAllSounds()}static async loadAllSounds(){const e=[];for(const[n,r]of this.soundUrls.entries())e.push(this.loadSound(r).then(h=>[n,h]));const t=await Promise.all(e);for(const[n,r]of t)this.sounds[n]=r;this.setVolume("music",.02),s.COMMAND_SYSTEM.addCommand("volume",n=>{(n[0]=="sfx"||n[0]=="music")&&this.setVolume(n[0],Number(n[1]))}),s.COMMAND_SYSTEM.addCommand("play",n=>{var r,h;n[0]=="music"?(this.stopAllMusic(),Object.values(oe).includes(n[1])&&((r=this.sounds[n[1]])==null||r.loop(!0).play())):n[0]=="sfx"&&Object.values(Z).includes(n[1])&&((h=this.sounds[n[1]])==null||h.play())})}static stopAllMusic(){for(const[e,t]of Object.entries(this.sounds))t.stop()}static loadSound(e){return new Promise((t,n)=>{const r=new Ye.Howl({src:[e],preload:!0,onload:()=>{console.log("Sound: Succesfully loaded -> "+e),t(r)},onloaderror:()=>n(new Error("Failed to load sound: "+e))})})}static getSounds(){return this.sounds}static setVolume(e,t){const n=Object.values(e==="sfx"?Z:oe);for(const r of n){const h=this.sounds[r];h&&h.volume(t)}}};ce.sounds={},ce.soundUrls=new Map().set("music0","resources/typePlatformer/music/bongSong.wav").set("pickup","resources/typePlatformer/sfx/pickUp.wav").set("living","resources/typePlatformer/music/living.wav").set("breaking0","resources/typePlatformer/sfx/breaking0.wav").set("finishbreaking0","resources/typePlatformer/sfx/finishBreaking0.wav").set("place","resources/typePlatformer/sfx/place.wav");let M=ce;class Xe{constructor(e,t){this.pauseMenuComponents=[],this.settingsMenuComponents=[],this.soundsMenuComponents=[],this.screen="none",this.pauseComponent=t,this.initPauseMenu(e),this.initSettingsMenu(e),this.initSoundMenu(e),s.COMMAND_SYSTEM.addCommand("pause",n=>{n[0]=="none",this.screen=n[0]})}initPauseMenu(e){const l=(this.pauseComponent.getHitbox().width-120)/2,m=(this.pauseComponent.getHitbox().height-40*3)/4,c=l,p=m,I={red:150,green:150,blue:150,alpha:1},i={red:100,green:100,blue:100,alpha:1},o={red:200,green:200,blue:200,alpha:1},a=[["Return to Game",()=>{this.screen="none"}],["Settings",()=>{this.screen="settings"}],["Quit",()=>{console.log("Why you quit")}]],d=g=>g>=a.length?"unknown":a[g][0],f=g=>g>=a.length?()=>{console.log("unknown")}:a[g][1];for(let g=0;g<3*1;g++){const u=g%1,y=Math.floor(g/1),b=c+u*(120+l),T=p+y*(40+m);this.pauseMenuComponents.push(new V(e,{x:b,y:T,width:120,height:40},I,!0,d(g),{red:255,green:255,blue:255,alpha:1},16,"center",i,{red:255,green:255,blue:255,alpha:1},o,void 0,f(g),void 0,void 0,!1)),this.pauseMenuComponents[this.pauseMenuComponents.length-1].setParentComponent(this.pauseComponent)}}initSettingsMenu(e){const l=(this.pauseComponent.getHitbox().width-360)/4,m=(this.pauseComponent.getHitbox().height-40*1)/2,c=l,p=m,I={red:150,green:150,blue:150,alpha:1},i={red:100,green:100,blue:100,alpha:1},o={red:200,green:200,blue:200,alpha:1},a=[["Controls",()=>{console.log("Controls Screen")}],["Sounds",()=>{this.screen="sounds"}],["Back",()=>{this.screen="pause"}]],d=g=>g>=a.length?"unknown":a[g][0],f=g=>g>=a.length?()=>{console.log("unknown")}:a[g][1];for(let g=0;g<1*3;g++){const u=g%3,y=Math.floor(g/3),b=c+u*(120+l),T=p+y*(40+m);this.settingsMenuComponents.push(new V(e,{x:b,y:T,width:120,height:40},I,!0,d(g),{red:255,green:255,blue:255,alpha:1},16,"center",i,{red:255,green:255,blue:255,alpha:1},o,void 0,f(g),void 0,void 0,!1)),this.settingsMenuComponents[this.settingsMenuComponents.length-1].setParentComponent(this.pauseComponent)}}initSoundMenu(e){const c=(this.pauseComponent.getHitbox().width-120)/2,p=(this.pauseComponent.getHitbox().height-40*3)/4,I=c,i=p,o={red:150,green:150,blue:150,alpha:1},a={red:100,green:100,blue:100,alpha:1},d={red:200,green:200,blue:200,alpha:1},f=[["Slider","Music Volume",b=>{console.log(b),M.setVolume("music",b)}],["Slider","SFX Volume",b=>{M.setVolume("sfx",b)}],["Button","Back",()=>{this.screen="pause"}]],g=b=>b>=f.length?"unknown":f[b][1],u=b=>b>=f.length?()=>{console.log("unknown")}:f[b][2],y=b=>b>=f.length?"None":f[b][0];for(let b=0;b<3*1;b++){const T=b%1,A=Math.floor(b/1),L=I+T*(120+c),C=i+A*(40+p);y(b)=="Button"?(this.soundsMenuComponents.push(new V(e,{x:L,y:C,width:120,height:40},o,!0,g(b),{red:255,green:255,blue:255,alpha:1},16,"center",a,{red:255,green:255,blue:255,alpha:1},d,void 0,u(b),void 0,void 0,!1)),this.soundsMenuComponents[this.soundsMenuComponents.length-1].setParentComponent(this.pauseComponent)):y(b)=="Slider"&&(this.soundsMenuComponents.push(new Q({x:L+120/2-160/2,y:C-8,width:160,height:8},{red:255,green:255,blue:255,alpha:.001},!0,g(b),{red:255,green:255,blue:255,alpha:1},8,"center"),new Fe({x:L+120/2-160/2,y:C,width:160,height:15},o,!0,a,1,u(b))),this.soundsMenuComponents[this.soundsMenuComponents.length-1].setParentComponent(this.pauseComponent),this.soundsMenuComponents[this.soundsMenuComponents.length-2].setParentComponent(this.pauseComponent))}}render(e){if(this.screen!="none"){if(this.pauseComponent.render(e),this.screen=="pause")for(let t=0;t<this.pauseMenuComponents.length;t++)this.pauseMenuComponents[t].render(e);else if(this.screen=="settings")for(let t=0;t<this.settingsMenuComponents.length;t++)this.settingsMenuComponents[t].render(e);else if(this.screen=="sounds")for(let t=0;t<this.soundsMenuComponents.length;t++)this.soundsMenuComponents[t].render(e)}}update(){if(s.INPUT_HANDLER.checkControl("Escape")&&this.screen=="none"&&(this.screen="pause"),this.hideAll(),this.screen=="pause")for(let e=0;e<this.pauseMenuComponents.length;e++)this.pauseMenuComponents[e].show(),this.pauseMenuComponents[e].update();else if(this.screen=="settings")for(let e=0;e<this.settingsMenuComponents.length;e++)this.settingsMenuComponents[e].show(),this.settingsMenuComponents[e].update();else if(this.screen=="sounds")for(let e=0;e<this.soundsMenuComponents.length;e++)this.soundsMenuComponents[e].show(),this.soundsMenuComponents[e].update()}hideAll(){for(let e=0;e<this.pauseMenuComponents.length;e++)this.pauseMenuComponents[e].hide();for(let e=0;e<this.settingsMenuComponents.length;e++)this.settingsMenuComponents[e].hide();for(let e=0;e<this.soundsMenuComponents.length;e++)this.soundsMenuComponents[e].hide()}setPauseScreen(e){this.screen=e}}class ze{constructor(e){this.healhBar=[],this.player=e,this.healhBar.push(new F({x:1,y:1,width:140,height:18},{red:128,green:128,blue:128,alpha:.5},!1)),this.healhBar.push(new F({x:6,y:3,width:130,height:14},{red:200,green:50,blue:50,alpha:1},!1))}render(e){for(let t=0;t<this.healhBar.length;t++)this.healhBar[t].render(e)}update(){this.healhBar[1].setHitbox({...this.healhBar[1].getHitbox(),width:Math.max(this.player.getHealthComponent().getHealth()/this.player.getHealthComponent().getMaxHealth()*130,0)})}}class je{constructor(e,t,n,r){this.player=t,this.camera=n,this.uiDebugHandler=new We(e,new F({x:0,y:0,width:s.CANVAS_WIDTH/5,height:s.CANVAS_HEIGHT},{red:255,green:0,blue:0,alpha:.5},!0),this.player,this.camera),this.uiChatHandler=new Ue(e,new F({x:s.CANVAS_WIDTH-s.CANVAS_WIDTH/5,y:0,width:s.CANVAS_WIDTH/5,height:s.CANVAS_HEIGHT/2},{red:255,green:0,blue:0,alpha:.5},!1)),s.COMMAND_SYSTEM.addCommand("debug",h=>{s.INPUT_HANDLER.setToggle(this.player.getControls().debug,!s.INPUT_HANDLER.getKeyToggled()[this.player.getControls().debug])}),this.uiPauseHandler=new Xe(e,new F({x:20,y:20,width:s.CANVAS_WIDTH-40,height:s.CANVAS_HEIGHT-40},{red:100,green:100,blue:100,alpha:.5},!1)),this.uiDeathHandler=new Oe(e,new F({x:20,y:20,width:s.CANVAS_WIDTH-40,height:s.CANVAS_HEIGHT-40},{red:100,green:100,blue:100,alpha:.5},!1),t),this.uiPlayerHandler=new ze(this.player),this.uiCharacterChooserHandler=new Ve(e,new F({x:s.CANVAS_WIDTH/2-50,y:s.CANVAS_HEIGHT/2-55,width:100,height:135},{red:255,green:0,blue:0,alpha:.5},!0),this.player)}render(e){this.uiDebugHandler.render(e),this.uiChatHandler.render(e),this.uiCharacterChooserHandler.render(e),this.uiPlayerHandler.render(e),this.uiPauseHandler.render(e),this.uiDeathHandler.render(e)}update(){this.uiChatHandler.update(),this.player.getHealthComponent().isDead()?(this.uiDeathHandler.show(),this.uiDeathHandler.update(),this.uiDebugHandler.hide(),this.uiPauseHandler.setPauseScreen("none")):(this.uiDebugHandler.update(),this.uiCharacterChooserHandler.update(),s.INPUT_HANDLER.getKeyToggled()["/"]?this.uiChatHandler.hide():this.uiChatHandler.show(),s.INPUT_HANDLER.getKeyToggled().m?this.uiCharacterChooserHandler.show():this.uiCharacterChooserHandler.hide(),this.uiPauseHandler.update(),this.uiDeathHandler.hide()),this.uiPlayerHandler.update()}getChatHandler(){return this.uiChatHandler}}class Ie{constructor(e,t,n={x:120,y:120}){this.velocity={x:0,y:0},this.hitboxComponent=e,this.velocity=n,this.slot=t}update(e,t){const n=this.hitboxComponent.getHitbox();if(this.hitboxComponent.setHitbox({...n,x:n.x+this.velocity.x*e,y:n.y+this.velocity.y*e}),t){const r=t.x-n.x,h=t.y-n.y;if(r*r+h*h<50*50){let l=Math.atan2(h,r);this.velocity.x=30*Math.cos(l),this.velocity.y=30*Math.sin(l)}else this.velocity.x*=.9,this.velocity.y*=.9}else this.velocity.x*=.9,this.velocity.y*=.9}render(e){if(!this.slot.isEmpty()){const t=this.slot.getItem().getImage(),n=this.hitboxComponent.getHitbox();t?e.drawImage(t,n.x,n.y,n.width,n.height):(e.fillStyle="#FF13F0",e.fillRect(n.x,n.y,n.width/2,n.height/2),e.fillRect(n.x+n.width/2,n.y+n.height/2,n.width/2,n.height/2),e.fillStyle="rgb(0,0,0)",e.fillRect(n.x,n.y+n.height/2,n.width/2,n.height/2),e.fillRect(n.x+n.width/2,n.y,n.width/2,n.height/2))}}getHitboxComponent(){return this.hitboxComponent}getSlot(){return this.slot}setSlot(e){this.slot=e}}class H{constructor(e,t,n="TILEHE",r={breakTime:50,solid:!1}){this.id=e,this.numberID=t,this.name=n,this.item=v.registerTileItem(this),this.settings=r}loadImage(){if(this.numberID>5){let e="resources/typePlatformer/images/tiles/"+this.id+".png";w.getImages().forEach(t=>{var n;t.src.substring((n=t.src.match("resources"))==null?void 0:n.index)===e&&(this.img=t)})}}getItem(){return this.item}getNumberID(){return this.numberID}getId(){return this.id}getName(){return this.name}render(e,t){const n=t.getHitbox();if(this.numberID<=5){let r=this.numberID%3*s.TILE_SIZE,h=Math.floor(this.numberID/3)*s.TILE_SIZE;e.imageSmoothingEnabled=!1,e.drawImage(w.getImages()[0],r,h,s.TILE_SIZE,s.TILE_SIZE,n.x,n.y,s.TILE_SIZE,s.TILE_SIZE)}else this.img?e.drawImage(this.img,0,0,s.TILE_SIZE,s.TILE_SIZE,n.x,n.y,s.TILE_SIZE,s.TILE_SIZE):(e.fillStyle="#FF13F0",e.fillRect(n.x,n.y,s.TILE_SIZE/2,s.TILE_SIZE/2),e.fillRect(n.x+s.TILE_SIZE/2,n.y+s.TILE_SIZE/2,s.TILE_SIZE/2,s.TILE_SIZE/2),e.fillStyle="rgb(0,0,0)",e.fillRect(n.x,n.y+s.TILE_SIZE/2,s.TILE_SIZE/2,s.TILE_SIZE/2),e.fillRect(n.x+s.TILE_SIZE/2,n.y,s.TILE_SIZE/2,s.TILE_SIZE/2))}getSettings(){return{...this.settings}}getImage(){return this.img}}const x=class x{static getTileByNumberId(e){for(const t in this.tiles)if(this.tiles[t].getNumberID()==e)return this.tiles[t];return this.EMPTY}static getTileById(e){return this.tiles[e]?this.tiles[e]:this.EMPTY}static loadTilesImgs(){for(const e in this.tiles)this.tiles[e].loadImage()}};x.EMPTY=new H("empty",0),x.GRASS=new H("grass",1,"Grass",{breakTime:50,solid:!1}),x.ROCK=new H("rock",2,"Rock",{...x.GRASS.getSettings(),solid:!0}),x.HOLE=new H("hole",3,"Hole",x.ROCK.getSettings()),x.TREE=new H("tree",4,"Small Tree",x.ROCK.getSettings()),x.DEAD_TREE=new H("deadtree",5,"Dead Small Tree",x.ROCK.getSettings()),x.TREE_STUMP=new H("tree_stump",6,"Tree Stump",x.ROCK.getSettings()),x.TREE_LEAVES=new H("tree_leaves",7,"Tree Leave",x.ROCK.getSettings()),x.WOOD=new H("wood",8,"Wood",{breakTime:25,solid:!0}),x.POTION_BOWL=new H("potion_bowl",9,"Potion Bowl",{breakTime:5,solid:!1}),x.TOOL_LOOT_BOX=new H("tool_loot_box",10,"Loot Box(tool)",{breakTime:25,solid:!0}),x.BIG_TREE_BR=new H("big_tree_br",11,"Big Tree Part",x.TREE_STUMP.getSettings()),x.BIG_TREE_MR=new H("big_tree_mr",12,"Big Tree Part",x.TREE_STUMP.getSettings()),x.BIG_TREE_TR=new H("big_tree_tr",13,"Big Tree Part",x.TREE_LEAVES.getSettings()),x.BIG_TREE_BL=new H("big_tree_bl",14,"Big Tree Part",x.TREE_LEAVES.getSettings()),x.BIG_TREE_ML=new H("big_tree_ml",15,"Big Tree Part",x.TREE_LEAVES.getSettings()),x.BIG_TREE_TL=new H("big_tree_tl",16,"Big Tree Part",x.TREE_LEAVES.getSettings()),x.tiles={},(()=>{for(const e of Object.getOwnPropertyNames(x)){const t=x[e];t instanceof H&&(x.tiles[t.getId()]=t)}})();let E=x;const W=class W{static random(e){return e[Math.floor(Math.random()*e.length)]}static getTileDrop(e){var n;const t=(n=this.DROPS.get(e))==null?void 0:n();return t||v.EMPTY}};W.DROPS=new Map,W.DROPS.set(E.GRASS,()=>E.GRASS.getItem()),W.DROPS.set(E.TREE_STUMP,()=>E.WOOD.getItem()),W.DROPS.set(E.TREE_LEAVES,()=>W.random([E.WOOD.getItem(),E.TREE_LEAVES.getItem()])),W.DROPS.set(E.POTION_BOWL,()=>v.SPEED_UP_POTION),W.DROPS.set(E.TOOL_LOOT_BOX,()=>W.random([v.PICKAXE,v.SWORD_2]));let de=W;class fe{constructor(e,t){this.shape=e,this.anchor=t}getShape(){return this.shape}getAnchor(){return this.anchor}}const se=class se{};se.TREE=new fe([[{tile:E.TREE_LEAVES,layer:1}],[{tile:E.TREE_STUMP,layer:0}]],{x:0,y:1}),se.BIG_TREE=new fe([[{tile:E.BIG_TREE_TL,layer:1},{tile:E.BIG_TREE_TR,layer:1}],[{tile:E.BIG_TREE_ML,layer:1},{tile:E.BIG_TREE_MR,layer:1}],[{tile:E.BIG_TREE_BL,layer:0},{tile:E.BIG_TREE_BR,layer:0}]],{x:0,y:2}),se.GRASS=new fe([[{tile:E.GRASS,layer:0}]],{x:0,y:0});let U=se;const Le=Math.sqrt(3),qe=.5*(Le-1),ne=(3-Le)/6,ye=_=>Math.floor(_)|0,be=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Ee(_=Math.random){const e=$e(_),t=new Float64Array(e).map(r=>be[r%12*2]),n=new Float64Array(e).map(r=>be[r%12*2+1]);return function(h,l){let m=0,c=0,p=0;const I=(h+l)*qe,i=ye(h+I),o=ye(l+I),a=(i+o)*ne,d=i-a,f=o-a,g=h-d,u=l-f;let y,b;g>u?(y=1,b=0):(y=0,b=1);const T=g-y+ne,A=u-b+ne,L=g-1+2*ne,C=u-1+2*ne,j=i&255,S=o&255;let Y=.5-g*g-u*u;if(Y>=0){const B=j+e[S],D=t[B],$=n[B];Y*=Y,m=Y*Y*(D*g+$*u)}let X=.5-T*T-A*A;if(X>=0){const B=j+y+e[S+b],D=t[B],$=n[B];X*=X,c=X*X*(D*T+$*A)}let q=.5-L*L-C*C;if(q>=0){const B=j+1+e[S+1],D=t[B],$=n[B];q*=q,p=q*q*(D*L+$*C)}return 70*(m+c+p)}}function $e(_){const t=new Uint8Array(512);for(let n=0;n<512/2;n++)t[n]=n;for(let n=0;n<512/2-1;n++){const r=n+~~(_()*(256-n)),h=t[n];t[n]=t[r],t[r]=h}for(let n=256;n<512;n++)t[n]=t[n-256];return t}var he={exports:{}},Je=he.exports,xe;function Qe(){return xe||(xe=1,function(_,e){(function(t,n){_.exports=n()})(Je,function(){return t.importState=function(r){var h=new t;return h.importState(r),h},t;function t(){return function(r){var h=0,l=0,m=0,c=1;r.length==0&&(r=[+new Date]);var p=n();h=p(" "),l=p(" "),m=p(" ");for(var I=0;I<r.length;I++)h-=p(r[I]),h<0&&(h+=1),l-=p(r[I]),l<0&&(l+=1),m-=p(r[I]),m<0&&(m+=1);p=null;var i=function(){var o=2091639*h+c*23283064365386963e-26;return h=l,l=m,m=o-(c=o|0)};return i.next=i,i.uint32=function(){return i()*4294967296},i.fract53=function(){return i()+(i()*2097152|0)*11102230246251565e-32},i.version="Alea 0.9",i.args=r,i.exportState=function(){return[h,l,m,c]},i.importState=function(o){h=+o[0]||0,l=+o[1]||0,m=+o[2]||0,c=+o[3]||0},i}(Array.prototype.slice.call(arguments))}function n(){var r=4022871197,h=function(l){l=l.toString();for(var m=0;m<l.length;m++){r+=l.charCodeAt(m);var c=.02519603282416938*r;r=c>>>0,c-=r,c*=r,r=c>>>0,c-=r,r+=c*4294967296}return(r>>>0)*23283064365386963e-26};return h.version="Mash 0.9",h}})}(he)),he.exports}var et=Qe();const Te=Ge(et);class tt{constructor(e,t=new O({x:0,y:0,width:s.TILE_SIZE,height:s.TILE_SIZE},{red:0,green:0,blue:0,alpha:0})){this.layers=new Array,this.layers=e,this.hitboxComponent=t}setLayer(e,t){t&&(this.layers[e].tile=t)}getLayers(){return{...this.layers}}getHitboxComponent(){return this.hitboxComponent}render(e,t){this.layers[t]!=null&&this.layers[t].tile!=E.EMPTY&&this.layers[t].tile.render(e,this.hitboxComponent)}}class it{constructor(){this.img=new Image,this.mouseImg=new Image,this.brekaingImg=new Image,this.showChunks=!1,this.droppedItems=[],this.selectedItem=v.EMPTY,this.breakingTile=void 0,this.breakTime=0,this.breakingLayer=0,this.seed="seed",this.worldMap=new Map,this.img.src="./resources/typePlatformer/images/tiles/background/grass.png",w.getImages().forEach(e=>{var t;e.src.substring((t=e.src.match("resources"))==null?void 0:t.index)==="resources/typePlatformer/images/misc/mouseSelction.png"&&(this.mouseImg=e)}),w.getImages().forEach(e=>{var t;e.src.substring((t=e.src.match("resources"))==null?void 0:t.index)==="resources/typePlatformer/images/misc/breaking.png"&&(this.brekaingImg=e)}),s.COMMAND_SYSTEM.addCommand("chunkOutline",e=>{e.length===0?this.showChunks=!this.showChunks:e[0]==="show"?this.showChunks=!0:e[0]==="hide"&&(this.showChunks=!1)}),s.COMMAND_SYSTEM.addCommand("worldReset",e=>{this.worldMap=new Map,e[0]&&(this.seed=e[0],this.prng=Te(this.seed),this.noise2D=Ee(this.prng))}),this.droppedItems.push(new Ie(new O({x:0,y:0,width:s.TILE_SIZE/2,height:s.TILE_SIZE/2}),new K(v.PICKAXE,1))),this.prng=Te(this.seed),this.noise2D=Ee(this.prng)}renderBackground(e,t){e.drawImage(this.img,t.getView().x-(t.getView().x+t.getView().width/2)%(s.TILE_SIZE*2)-32,t.getView().y-(t.getView().y+t.getView().height/2)%(s.TILE_SIZE*2)-32)}renderLayer(e,t,n){let r=Math.floor((n.getView().x+n.getView().width/2)/(s.TILE_SIZE*s.CHUNK_SIZE)),h=Math.floor((n.getView().y+n.getView().height/2)/(s.TILE_SIZE*s.CHUNK_SIZE)),l=r-s.RENDER_DISTANCE+1,m=h-s.RENDER_DISTANCE+1;for(let c=m;c<h+s.RENDER_DISTANCE;c++)for(let p=l;p<r+s.RENDER_DISTANCE;p++)if(this.worldMap.has(p+", "+c)){for(let I=0;I<s.CHUNK_SIZE;I++)for(let i=0;i<s.CHUNK_SIZE;i++)te(n.getView(),this.getChunk(p,c)[I][i].getHitboxComponent().getHitbox())&&this.getChunk(p,c)[I][i].render(t,e);this.showChunks&&t.strokeRect(this.getChunk(c,p)[0][0].getHitboxComponent().getHitbox().x,this.getChunk(c,p)[0][0].getHitboxComponent().getHitbox().y,s.CHUNK_SIZE*s.TILE_SIZE,s.CHUNK_SIZE*s.TILE_SIZE)}}renderDropItems(e,t){for(let n=0;n<this.droppedItems.length;n++)te(t.getView(),this.droppedItems[n].getHitboxComponent().getHitbox())&&this.droppedItems[n].render(e)}renderMouse(e,t){if(this.mouseImg&&e.drawImage(this.mouseImg,s.INPUT_HANDLER.getMouseWorldTilePosition(t).x*s.TILE_SIZE-1,s.INPUT_HANDLER.getMouseWorldTilePosition(t).y*s.TILE_SIZE-1),this.selectedItem!=v.EMPTY&&this.selectedItem.getSettings().isBlockItem){const n=E.getTileById(this.selectedItem.getId()).getImage();n&&(e.globalAlpha=.25,e.drawImage(n,s.INPUT_HANDLER.getMouseWorldTilePosition(t).x*s.TILE_SIZE,s.INPUT_HANDLER.getMouseWorldTilePosition(t).y*s.TILE_SIZE),e.globalAlpha=1)}if(this.breakingTile&&this.brekaingImg){const n=this.breakingTile.getLayers()[this.breakingLayer].tile.getSettings().breakTime;this.breakTime%n<n/5?e.drawImage(this.brekaingImg,0,0,s.TILE_SIZE,s.TILE_SIZE,s.INPUT_HANDLER.getMouseWorldTilePosition(t).x*s.TILE_SIZE-1,s.INPUT_HANDLER.getMouseWorldTilePosition(t).y*s.TILE_SIZE-1,s.TILE_SIZE,s.TILE_SIZE):this.breakTime%n<n/5*2?e.drawImage(this.brekaingImg,s.TILE_SIZE,0,s.TILE_SIZE,s.TILE_SIZE,s.INPUT_HANDLER.getMouseWorldTilePosition(t).x*s.TILE_SIZE-1,s.INPUT_HANDLER.getMouseWorldTilePosition(t).y*s.TILE_SIZE-1,s.TILE_SIZE,s.TILE_SIZE):this.breakTime%n<n/5*3?e.drawImage(this.brekaingImg,s.TILE_SIZE*2,0,s.TILE_SIZE,s.TILE_SIZE,s.INPUT_HANDLER.getMouseWorldTilePosition(t).x*s.TILE_SIZE-1,s.INPUT_HANDLER.getMouseWorldTilePosition(t).y*s.TILE_SIZE-1,s.TILE_SIZE,s.TILE_SIZE):this.breakTime%n<n/5*4?e.drawImage(this.brekaingImg,s.TILE_SIZE*3,0,s.TILE_SIZE,s.TILE_SIZE,s.INPUT_HANDLER.getMouseWorldTilePosition(t).x*s.TILE_SIZE-1,s.INPUT_HANDLER.getMouseWorldTilePosition(t).y*s.TILE_SIZE-1,s.TILE_SIZE,s.TILE_SIZE):this.breakTime%n<n&&e.drawImage(this.brekaingImg,s.TILE_SIZE*4,0,s.TILE_SIZE,s.TILE_SIZE,s.INPUT_HANDLER.getMouseWorldTilePosition(t).x*s.TILE_SIZE-1,s.INPUT_HANDLER.getMouseWorldTilePosition(t).y*s.TILE_SIZE-1,s.TILE_SIZE,s.TILE_SIZE)}}update(e){let t=Math.floor((e.getView().x+e.getView().width/2)/(s.TILE_SIZE*s.CHUNK_SIZE)),n=Math.floor((e.getView().y+e.getView().height/2)/(s.TILE_SIZE*s.CHUNK_SIZE)),r=t-s.RENDER_DISTANCE+1,h=n-s.RENDER_DISTANCE+1;for(let l=h;l<n+s.RENDER_DISTANCE;l++)for(let m=r;m<t+s.RENDER_DISTANCE;m++)this.worldMap.has(m+", "+l)||this.generateChunk(m,l,1)}getDroppedItems(){return this.droppedItems}generateChunk(e,t,n){let r=[];for(let c=0;c<s.CHUNK_SIZE;c++){const p=[];for(let I=0;I<s.CHUNK_SIZE;I++){let i=(e*s.CHUNK_SIZE+I)*s.TILE_SIZE,o=(t*s.CHUNK_SIZE+c)*s.TILE_SIZE;p.push(new tt([{tile:E.EMPTY},{tile:E.EMPTY},{tile:E.EMPTY},{tile:E.EMPTY}],new O({x:i,y:o,width:s.TILE_SIZE,height:s.TILE_SIZE},{red:0,green:0,blue:0,alpha:0})))}r.push(p)}const h=.1;for(let c=0;c<s.CHUNK_SIZE;c++)for(let p=0;p<s.CHUNK_SIZE;p++)(this.noise2D(p+e*16,c+t*16)+1)/2<h&&this.placeFeature(r,U.TREE,p,c);const l=.2;for(let c=0;c<s.CHUNK_SIZE;c++)for(let p=0;p<s.CHUNK_SIZE;p++)(this.noise2D(p+e*16,c+t*16)+1)/2<l&&r[c][p].getLayers()[U.BIG_TREE.getShape()[U.BIG_TREE.getAnchor().y][U.BIG_TREE.getAnchor().x].layer].tile==E.EMPTY&&this.placeFeature(r,U.BIG_TREE,p,c);const m=.25;for(let c=0;c<s.CHUNK_SIZE;c++)for(let p=0;p<s.CHUNK_SIZE;p++)(this.noise2D(p+e*16,c+t*16)+1)/2<m&&r[c][p].getLayers()[U.GRASS.getShape()[U.GRASS.getAnchor().y][U.GRASS.getAnchor().x].layer].tile==E.EMPTY&&this.placeFeature(r,U.GRASS,p,c);return this.worldMap.set(e+", "+t,r),r}placeFeature(e,t,n,r){const h=t.getShape(),l=t.getAnchor();for(let m=0;m<h.length;m++)for(let c=0;c<h[m].length;c++){const p=n+c-l.x,I=r+m-l.y;if(p>=0&&p<s.CHUNK_SIZE&&I>=0&&I<s.CHUNK_SIZE){let i=h[m][c].layer;const o=h[m][c].tile;for(;e[I][p].getLayers()[i].tile!=E.EMPTY;)i++;e[I][p].setLayer(i,o)}}}getWorldMap(){return this.worldMap}getChunk(e,t){return this.worldMap.has(e+", "+t)?this.worldMap.get(e+", "+t):this.generateChunk(e,t,1)}setWorldMap(e){this.worldMap=e}showChunksOutlines(){this.showChunks=!0}hideChunksOutlines(){this.showChunks=!1}dropItem(e,t,n={x:120,y:120}){this.droppedItems.push(new Ie(new O({...t,width:s.TILE_SIZE/1.5,height:s.TILE_SIZE/1.5}),new K(e.getItem(),e.getItemCount()),n)),e.removeItem()}setSelectedItem(e){this.selectedItem=e}getWorldTile(e){const t=(n,r)=>(n%r+r)%r;return this.getChunk(Math.floor(e.x/s.CHUNK_SIZE),Math.floor(e.y/s.CHUNK_SIZE))[t(e.y,s.CHUNK_SIZE)][t(e.x,s.CHUNK_SIZE)]}setBreakingTile(e,t){this.breakingTile=e,this.breakingLayer=t,this.breakTime=0}updateBreakTime(){this.breakTime++}getBreakTime(){return this.breakTime}clearBreakingTile(){this.breakingTile=void 0,this.breakTime=0}getBreakingTile(){return this.breakingTile}breakTile(e){var t;if(this.breakingTile){const n=de.getTileDrop(this.breakingTile.getLayers()[e].tile),r=this.breakingTile.getHitboxComponent().getHitbox();n!=v.EMPTY?this.dropItem(new K(n,1),r):this.dropItem(new K(this.breakingTile.getLayers()[e].tile.getItem(),1),r),(t=this.breakingTile)==null||t.setLayer(e,E.EMPTY),this.clearBreakingTile()}}saveWorld(){}}class nt{constructor(){this.playerCollisions=!0}update(e,t,n,r){for(let h=0;h<e.length;h++)this.handleToolCollisions(e[h],h,e,t),this.handleAxisEntityMovement("x",e[h],r),this.handleAxisCollision("x",e[h],n),this.handleAxisEntityMovement("y",e[h],r),this.handleAxisCollision("y",e[h],n)}handleToolCollisions(e,t,n,r){for(let h=0;h<n.length;h++)if(!(e==n[h]||e.getType()==n[h].getType()||n[h].getHealthComponent().isDead())&&n[h].isUsingTool()){const l=n[h].getHitboxComponent().getHitbox();if(De(we(e.getHitboxComponent().getHitbox()),n[h].getToolHitboxPts())&&!e.isHit()){if(e.hit(n[h].getToolSlot().getItem()instanceof ee?n[h].getToolSlot().getItem().getDamage():0),e.getHealthComponent().isDead()){this.handleEntityDeath(e,r);return}e.applyKnockback({x:l.x+l.width/2,y:l.y+l.height/2},200)}}}handleEntityDeath(e,t){e.getType()!="player"&&t.push(e)}handleAxisEntityMovement(e,t,n){const r=t.getHitboxComponent(),h=r.getHitbox();e==="x"?r.setHitbox({...h,x:h[e]+t.getVelocity()[e]*n}):r.setHitbox({...h,y:h[e]+t.getVelocity()[e]*n})}handleAxisCollision(e,t,n){if(!(t instanceof Ae&&!this.playerCollisions)&&t.getVelocity()[e]!=0)for(let[r,h]of n){let l=parseInt(r.substring(0,r.indexOf(", ")))*s.TILE_SIZE*s.CHUNK_SIZE,m=parseInt(r.substring(r.indexOf(", ")+2))*s.TILE_SIZE*s.CHUNK_SIZE;const c=t.getHitboxComponent(),p=c.getHitbox();if(te(p,{x:l,y:m,width:s.TILE_SIZE*s.CHUNK_SIZE,height:s.TILE_SIZE*s.CHUNK_SIZE}))for(let I=0;I<s.CHUNK_SIZE;I++)for(let i=0;i<s.CHUNK_SIZE;i++){const o=h[I][i].getHitboxComponent().getHitbox();if(te(p,o)&&h[I][i].getLayers()[t.getLayer()].tile.getSettings().solid){e==="x"?t.getVelocity()[e]>0?c.setHitbox({...p,x:o.x-p.width}):c.setHitbox({...p,x:o.x+s.TILE_SIZE}):e==="y"&&(t.getVelocity()[e]>0?c.setHitbox({...p,y:o.y-p.height}):c.setHitbox({...p,y:o.y+s.TILE_SIZE}));const a=t.getVelocity();a[e]=0,t.setVelocity(a);return}}}}setPlayerCollisions(e){this.playerCollisions=e}}class le extends He{constructor(e,t){super(e,t),this.lockActionTime=51,this.speed=(Math.random()*2+1)*30,this.usingSlot.setItem(de.getTileDrop(E.TOOL_LOOT_BOX),1),this.usingTool=!0,this.img=w.getImages()[3],this.type="enemy"}update(){if(!this.onPath&&!this.atGoal){if(this.lockActionTime>50){const e=Math.random()*100,t=Math.random()*100;e<33?(this.direction="up",this.inputVel.y=-this.speed):e<66?(this.direction="down",this.inputVel.y=this.speed):this.inputVel.y=0,t<33?(this.direction="left",this.inputVel.x=-this.speed):t<66?(this.direction="right",this.inputVel.x=this.speed):this.inputVel.x=0,this.lockActionTime=0,this.onPath=!1,this.path=[]}}else this.followPathAction();this.lockActionTime++,super.update()}render(e){super.renderUsingItem(e);const t=this.hitboxComponent.getHitbox();this.velocity.x!=0||this.velocity.y!=0?(e.imageSmoothingEnabled=!1,Ce(e,this.img,20/3,this.direction,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE)):this.direction==="up"?e.drawImage(this.img,0,s.TILE_SIZE*1,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE):this.direction==="down"?e.drawImage(this.img,0,0,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE):this.direction==="right"?e.drawImage(this.img,0,s.TILE_SIZE*3,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE):this.direction==="left"&&e.drawImage(this.img,s.TILE_SIZE*2,s.TILE_SIZE*2,s.TILE_SIZE,s.TILE_SIZE,t.x+t.width/2-s.TILE_SIZE/2,t.y+t.height-s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE)}}const ge=class ge{static getEntityDrop(e){let t;for(const[n,r]of this.DROPS.entries())e instanceof n&&(t=r());return t||v.EMPTY}};ge.DROPS=new Map,ge.DROPS.set(le,()=>v.FLESH);let me=ge;class st{constructor(e,t,n,r,h){this.interactionCoodown=.75,this.interactionCount=-this.interactionCoodown,this.player=e,this.worldHandler=t,this.camera=n,this.entities=h,this.inventoryHandler=r,this.inventoryHandler.addInventory(this.player.getHotbarInventory()),this.inventoryHandler.addInventory(this.player.getMainInventory())}update(e){this.player.getHealthComponent().isDead()?(this.checkDropInventories(),this.updateDroppedSlots(e)):(this.controlActions(),this.checkBreaking(),this.checkShouldDropItems(),this.updateWorldSelectedItem(),this.checkPickupItems(e)),this.checkDeadEntities()}checkDeadEntities(){for(let e=0;e<this.entities.length;e++)this.entities[e].getHealthComponent().isDead()&&this.entities[e].getType()!="player"&&(this.dropEntityItems(this.entities[e]),this.entities.splice(e,1))}dropEntityItems(e){const t=me.getEntityDrop(e),n=e.getHitboxComponent().getHitbox();t!=v.EMPTY&&this.worldHandler.dropItem(new K(t,1),n,{x:(Math.random()*2==2?1:-1)*(Math.random()*3)*60,y:(Math.random()*2==2?1:-1)*(Math.random()*3)*60})}checkDropInventories(){const e=this.player.getMainInventory(),t=this.player.getHotbarInventory();for(let n=0;n<t.getSize();n++){const r=t.getSlot(n);r.isEmpty()||this.worldHandler.dropItem(r,{x:this.player.getHitboxComponent().getHitbox().x,y:this.player.getHitboxComponent().getHitbox().y},{x:(Math.random()*2==2?1:-1)*(Math.random()*3)*60,y:(Math.random()*2==2?1:-1)*(Math.random()*3)*60})}for(let n=0;n<e.getSize();n++){const r=e.getSlot(n);r.isEmpty()||this.worldHandler.dropItem(r,{x:this.player.getHitboxComponent().getHitbox().x,y:this.player.getHitboxComponent().getHitbox().y},{x:(Math.random()*2==2?1:-1)*(Math.random()*3)*60,y:(Math.random()*2==2?1:-1)*(Math.random()*3)*60})}}checkShouldDropItems(){if(this.inventoryHandler.shouldDrop()){const e=this.inventoryHandler.getHeldSlot(),t=this.player.getHotbarInventory().getSelecteSlot();e.isEmpty()?t.isEmpty()||this.worldHandler.dropItem(t,{x:s.INPUT_HANDLER.getMousePosition().x/this.camera.getView().zoom+this.camera.getView().x,y:s.INPUT_HANDLER.getMousePosition().y/this.camera.getView().zoom+this.camera.getView().y}):this.worldHandler.dropItem(e,{x:s.INPUT_HANDLER.getMousePosition().x/this.camera.getView().zoom+this.camera.getView().x,y:s.INPUT_HANDLER.getMousePosition().y/this.camera.getView().zoom+this.camera.getView().y}),this.inventoryHandler.resetDroppedItem()}}updateWorldSelectedItem(){const e=this.inventoryHandler.getHeldSlot(),t=this.player.getHotbarInventory().getSelecteSlot();e.isEmpty()?this.worldHandler.setSelectedItem(t.getItem()):this.worldHandler.setSelectedItem(e.getItem())}controlActions(){var e,t;s.INPUT_HANDLER.checkControlToggle(this.player.getControls().inventory)?(e=this.inventoryHandler.getUIInventory("mainInventory"))==null||e.show():(t=this.inventoryHandler.getUIInventory("mainInventory"))==null||t.hide(),s.INPUT_HANDLER.checkControl(this.player.getControls().drop)&&this.inventoryHandler.getCanDrop()?(this.inventoryHandler.setDrop(!0),this.inventoryHandler.setCanDrop(!1)):s.INPUT_HANDLER.checkControl(this.player.getControls().drop)||this.inventoryHandler.setCanDrop(!0),s.INPUT_HANDLER.checkControl(this.player.getControls().break)&&!this.player.getBreaking()?this.setBreakingAtMouse():this.player.getBreaking()&&!s.INPUT_HANDLER.checkControl(this.player.getControls().break)?(this.player.setBreaking(!1),this.worldHandler.clearBreakingTile()):s.INPUT_HANDLER.checkControl(this.player.getControls().break)&&this.worldHandler.getBreakingTile()&&(N(s.INPUT_HANDLER.getMouseWorldPosition(this.camera),this.worldHandler.getBreakingTile().getHitboxComponent().getHitbox())||this.setBreakingAtMouse()),s.INPUT_HANDLER.checkControl(this.player.getControls().place)&&this.checkPlacing(),s.INPUT_HANDLER.checkControl(this.player.getControls().useItem)&&this.interactionCount+this.interactionCoodown<=s.TIME_HANDLER.getTime()&&this.checkUseItem()}checkUseItem(){const e=this.inventoryHandler.getHeldSlot(),t=this.player.getHotbarInventory().getSelecteSlot();e.getItem().getSettings().isConsumable?(e.getItem().getConsumableAction()(this.player),e.removeCount(1),this.interactionCount=s.TIME_HANDLER.getTime()):t.getItem().getSettings().isConsumable&&(t.getItem().getConsumableAction()(this.player),t.removeCount(1),this.interactionCount=s.TIME_HANDLER.getTime())}setBreakingAtMouse(){var t,n,r;let e=this.worldHandler.getWorldTile(s.INPUT_HANDLER.getMouseWorldTilePosition(this.camera));e.getLayers()[this.player.getLayer()].tile!=E.EMPTY?(this.player.setBreaking(!0),this.worldHandler.setBreakingTile(e,this.player.getLayer()),(t=M.getSounds()[Z.BREAKING_0])!=null&&t.playing()||(n=M.getSounds()[Z.BREAKING_0])==null||n.loop(!0).play()):(this.player.setBreaking(!1),this.worldHandler.clearBreakingTile(),(r=M.getSounds()[Z.BREAKING_0])==null||r.loop(!1).stop())}checkBreaking(){var e,t,n;if(this.player.getBreaking()){if(this.worldHandler.getBreakTime()>=this.worldHandler.getBreakingTile().getLayers()[this.player.getLayer()].tile.getSettings().breakTime){this.worldHandler.breakTile(this.player.getLayer()),this.player.setBreaking(!1),(e=M.getSounds()[Z.BREAKING_0])==null||e.loop(!1).stop(),(t=M.getSounds()[Z.FINISH_BREKAING_0])==null||t.play();return}this.worldHandler.updateBreakTime()}else(n=M.getSounds()[Z.BREAKING_0])==null||n.loop(!1).stop()}checkPlacing(){var t,n;let e=this.worldHandler.getWorldTile(s.INPUT_HANDLER.getMouseWorldTilePosition(this.camera));if(e.getLayers()[this.player.getLayer()].tile==E.EMPTY){const r=this.inventoryHandler.getHeldSlot(),h=this.player.getHotbarInventory().getSelecteSlot();if(!r.isEmpty()){r.getItem().getSettings().isBlockItem&&(e.setLayer(this.player.getLayer(),E.getTileById(r.getItem().getId())),r.removeCount(1),(t=M.getSounds()[Z.PLACE])==null||t.play());return}if(!h.isEmpty()){h.getItem().getSettings().isBlockItem&&(e.setLayer(this.player.getLayer(),E.getTileById(h.getItem().getId())),h.removeCount(1),(n=M.getSounds()[Z.PLACE])==null||n.play());return}}}checkPickupItems(e){var n;const t=this.worldHandler.getDroppedItems();for(let r=0;r<t.length;r++){let h=t[r].getSlot();const l=t[r].getHitboxComponent().getHitbox(),m=this.player.getHitboxComponent().getHitbox();if(te(this.camera.getView(),l)){if(te(m,t[r].getHitboxComponent().getHitbox())){const c=this.player.getHotbarInventory(),p=this.player.getMainInventory();h=J.transferItems(c,h),h.getItemCount()!=0&&(h=J.transferItems(p,h)),h.isEmpty()&&(t.splice(r,1),(n=M.getSounds()[Z.PICKUP])==null||n.play())}h.getItemCount()!=0&&this.updateDroppedSlots(e,{x:m.x+m.width/2,y:m.y+m.height/2},r)}}}updateDroppedSlots(e,t,n){const r=this.worldHandler.getDroppedItems();if(n){t?r[n].update(e,t):r[n].update(e);return}if(t)for(let h=0;h<r.length;h++)r[h].update(e,t);else for(let h=0;h<r.length;h++)r[h].update(e)}}class Se{constructor(e,t,n,r={red:128,green:0,blue:128,alpha:1},h){this.slotPlacement=[],this.mouseItem={inv:new J(0),index:-1,x:0,y:0,holdingItem:!1},this.canvas=e,this.inventory=t,this.placement=n,this.color=r,this.hidden=h,this.discription=new Q({x:0,y:0,width:100,height:25},{red:128,green:128,blue:128,alpha:.25},!0,void 0,{red:255,green:255,blue:255,alpha:1},10,"left",!1);let l=this.placement.x,m=this.placement.y,c=0,p=2;for(let I=0;I<this.placement.row;I++){m+=p;for(let i=0;i<this.placement.col;i++)if(c++,c<=this.inventory.getSize())l+=p,this.slotPlacement.push({x:l,y:m}),l+=s.TILE_SIZE;else{this.placement.row=I;break}l=0,m+=s.TILE_SIZE}this.holdingItem=!1,this.mouseItem.inv=t}mouseDown(e){for(let t=0;t<this.inventory.getSize();t++){const n=this.inventory.getSlot(t);if(e.holdingItem==!1)!n.isEmpty()&&N(s.INPUT_HANDLER.getMousePosition(),{...this.slotPlacement[t],width:s.TILE_SIZE,height:s.TILE_SIZE})&&(e.index=t,e.x=s.INPUT_HANDLER.getMousePosition().x-s.TILE_SIZE/2,e.y=s.INPUT_HANDLER.getMousePosition().y-s.TILE_SIZE/2,e.inv=this.inventory,e.holdingItem=!0,this.holdingItem=!0,this.discription.hide());else if(N(s.INPUT_HANDLER.getMousePosition(),{...this.slotPlacement[t],width:s.TILE_SIZE,height:s.TILE_SIZE}))if(t==e.index&&this.mouseItem.inv==this.inventory)e.index=-1,e.holdingItem=!1,this.holdingItem=!1,e.inv=this.inventory;else if(n.isEmpty())n.setItem(e.inv.getSlot(e.index).getItem(),e.inv.getSlot(e.index).getItemCount()),e.inv.getSlot(e.index).removeItem(),e.index=-1,e.holdingItem=!1,this.holdingItem=!1,e.inv=this.inventory;else if(n.getItem().getId()==e.inv.getSlot(e.index).getItem().getId())if(n.getItemCount()!=n.getMaxItemCount()){let r=0;if(r=n.addItems(e.inv.getSlot(e.index).getItemCount()),r>0)e.inv.getSlot(e.index).setItem(e.inv.getSlot(e.index).getItem(),r),e.inv=this.inventory;else{e.inv.getSlot(e.index).removeItem(),e.index=-1,e.holdingItem=!1,this.holdingItem=!1,e.inv=this.inventory;break}}else{let r=e.inv.getSlot(e.index).getItemCount(),h=e.inv.getSlot(e.index).getItem();e.inv.getSlot(e.index).setItem(n.getItem(),n.getItemCount()),n.setItem(h,r),e.inv=this.inventory}else{let r=e.inv.getSlot(e.index).getItemCount(),h=e.inv.getSlot(e.index).getItem();e.inv.getSlot(e.index).setItem(n.getItem(),n.getItemCount()),n.setItem(h,r),e.inv=this.inventory}}this.mouseItem=e}mouseDownSelction(){for(let e=0;e<this.inventory.getSize();e++)if(N(s.INPUT_HANDLER.getMousePosition(),{...this.slotPlacement[e],width:s.TILE_SIZE,height:s.TILE_SIZE})){this.inventory.setSelecteSlot(e);break}}mouseMove(){if(this.mouseItem.index==-1)for(let e=0;e<this.inventory.getSize();e++){const t=this.inventory.getSlot(e);if(!t.isEmpty()&&N(s.INPUT_HANDLER.getMousePosition(),{...this.slotPlacement[e],width:s.TILE_SIZE,height:s.TILE_SIZE})){this.discription.setHitbox({...this.discription.getHitbox(),x:s.INPUT_HANDLER.getMousePosition().x,y:s.INPUT_HANDLER.getMousePosition().y}),this.discription.update(t.getItem().getDiscription()),this.discription.show();break}else this.discription.hide()}}render(e){if(this.hidden)return;const t=7.5;e.imageSmoothingEnabled=!1;for(let n=0;n<this.inventory.getSize();n++){e.fillStyle="rgba("+this.color.red+", "+this.color.green+", "+this.color.blue+", "+this.color.alpha+")",e.fillRect(this.slotPlacement[n].x,this.slotPlacement[n].y,s.TILE_SIZE,s.TILE_SIZE);const r=this.inventory.getSlot(n);if(!r.isEmpty()&&this.mouseItem.index!=n){const h=r.getItem().getImage();h?e.drawImage(h,this.slotPlacement[n].x,this.slotPlacement[n].y):(e.fillStyle="#FF13F0",e.fillRect(this.slotPlacement[n].x,this.slotPlacement[n].y,s.TILE_SIZE/2,s.TILE_SIZE/2),e.fillRect(this.slotPlacement[n].x+s.TILE_SIZE/2,this.slotPlacement[n].y+s.TILE_SIZE/2,s.TILE_SIZE/2,s.TILE_SIZE/2),e.fillStyle="rgb(0,0,0)",e.fillRect(this.slotPlacement[n].x,this.slotPlacement[n].y+s.TILE_SIZE/2,s.TILE_SIZE/2,s.TILE_SIZE/2),e.fillRect(this.slotPlacement[n].x+s.TILE_SIZE/2,this.slotPlacement[n].y,s.TILE_SIZE/2,s.TILE_SIZE/2)),e.fillStyle="white",e.font=t+"px serif",e.textAlign="left",e.fillText(r.getItemCount().toString(),this.slotPlacement[n].x,this.slotPlacement[n].y+s.TILE_SIZE)}}this.inventory.getType()=="hotbar"&&(e.strokeStyle="yellow",e.strokeRect(this.inventory.getSelecteSlotIndex()%this.placement.col*s.TILE_SIZE+this.inventory.getSelecteSlotIndex()%this.placement.col*2+e.lineWidth,Math.floor(this.inventory.getSelecteSlotIndex()%this.placement.row)*s.TILE_SIZE+Math.floor(this.inventory.getSelecteSlotIndex()%this.placement.row)*2+e.lineWidth+this.placement.y,s.TILE_SIZE+2,s.TILE_SIZE+2)),this.discription.render(e)}renderMouseItem(e){if(e.imageSmoothingEnabled=!1,this.mouseItem.index!=-1&&this.mouseItem.inv==this.inventory){const r=this.inventory.getSlot(this.mouseItem.index).getItem().getImage();r?e.drawImage(r,this.mouseItem.x,this.mouseItem.y,s.TILE_SIZE/1.5,s.TILE_SIZE/1.5):(e.fillStyle="#FF13F0",e.fillRect(this.mouseItem.x,this.mouseItem.y,s.TILE_SIZE/4,s.TILE_SIZE/4),e.fillRect(this.mouseItem.x+s.TILE_SIZE/4,this.mouseItem.y+s.TILE_SIZE/4,s.TILE_SIZE/4,s.TILE_SIZE/4),e.fillStyle="rgb(0,0,0)",e.fillRect(this.mouseItem.x,this.mouseItem.y+s.TILE_SIZE/4,s.TILE_SIZE/4,s.TILE_SIZE/4),e.fillRect(this.mouseItem.x+s.TILE_SIZE/4,this.mouseItem.y,s.TILE_SIZE/4,s.TILE_SIZE/4)),e.fillStyle="white",e.font="10px serif",e.fillText(this.inventory.getSlot(this.mouseItem.index).getItemCount().toString(),this.mouseItem.x+2,this.mouseItem.y+s.TILE_SIZE-2-e.lineWidth)}}getPlacementBox(){return{x:this.placement.x,y:this.placement.y,width:this.placement.col*s.TILE_SIZE+(this.placement.col-1)*2,height:this.placement.row*s.TILE_SIZE+(this.placement.row-1)*2}}getInventory(){return this.inventory}hide(){this.hidden=!0}show(){this.hidden=!1}ishidden(){return this.hidden}update(e){this.mouseItem=e}setInventory(e){this.inventory=e}}class ot{constructor(e){this.UIInventories=[],this.mouseItem={inv:new J(0),index:-1,x:0,y:0,holdingItem:!1},this.drop=!1,this.canDrop=!1,this.emptySlot=new K,this.canvas=e,this.inventories=[]}mouseDown(){if(s.INPUT_HANDLER.isLeftDown()&&s.INPUT_HANDLER.wasJustLeftClicked())for(let e=0;e<this.inventories.length;e++){const t=this.UIInventories[e];if(N(s.INPUT_HANDLER.getMousePosition(),{...t.getPlacementBox()})&&!t.ishidden()){this.inventories[e].getType()=="hotbar"&&!this.isMainInventoryOpen()?t.mouseDownSelction():t.mouseDown(this.mouseItem);return}}}mouseMove(){this.mouseItem.index!=-1&&(this.mouseItem.x=s.INPUT_HANDLER.getMousePosition().x-s.TILE_SIZE/2,this.mouseItem.y=s.INPUT_HANDLER.getMousePosition().y-s.TILE_SIZE/2);for(let e=0;e<this.inventories.length;e++)this.inventories[e]==this.mouseItem.inv&&this.UIInventories[e].mouseMove()}isMainInventoryOpen(){for(let e=0;e<this.inventories.length;e++)if(this.inventories[e].getType()=="mainInventory"&&!this.UIInventories[e].ishidden())return!0;return!1}addInventory(e,t){for(let n=0;n<this.inventories.length;n++)if(e.getType()==this.inventories[n].getType()){this.inventories[n]=e,this.UIInventories[n].setInventory(e);return}switch(this.inventories.push(e),e.getType()){case"hotbar":this.UIInventories.push(new Se(this.canvas,e,{x:0,y:18,row:1,col:7},{red:128,green:128,blue:128,alpha:1},!1));break;case"mainInventory":this.UIInventories.push(new Se(this.canvas,e,{x:0,y:36,row:2,col:7},void 0,!1));break;default:t?this.UIInventories.push(t):this.inventories.pop()}}render(e){for(let t=0;t<this.inventories.length;t++)this.UIInventories[t].render(e);for(let t=0;t<this.inventories.length;t++)this.UIInventories[t].renderMouseItem(e)}update(){this.mouseDown(),this.mouseMove();for(let e=0;e<this.inventories.length;e++){const t=this.UIInventories[e];if(t.ishidden()&&this.mouseItem.inv==this.inventories[e]&&this.mouseItem.holdingItem){this.mouseItem.index=-1,this.mouseItem.holdingItem=!1,t.update(this.mouseItem);break}}this.getHeldSlot().isEmpty()&&(this.mouseItem.index=-1,this.mouseItem.holdingItem=!1)}getUIInventory(e){for(let t=0;t<this.inventories.length;t++)if(this.inventories[t].getType()==e)return this.UIInventories[t]}shouldDrop(){return this.drop}setDrop(e){this.drop=e}getHeldSlot(){return this.mouseItem.holdingItem?this.mouseItem.inv.getSlot(this.mouseItem.index):this.emptySlot}resetDroppedItem(e){this.mouseItem.holdingItem&&(this.mouseItem.holdingItem=!1,this.mouseItem.index=-1),this.drop=!1}setCanDrop(e){this.canDrop=e}getCanDrop(){return this.canDrop}}class ae{constructor(){this.parent=void 0,this.hCost=0,this.gCost=0,this.fCost=0,this.solid=!1,this.open=!1,this.checked=!1,this.starting=!1,this.goal=!1,this.pos={x:0,y:0}}setGCost(e){this.gCost=e}setHCost(e){this.hCost=e}setFCost(e){this.fCost=e}setStarting(e){this.starting=e}setGoal(e){this.goal=e}setSolid(e){this.solid=e}setOpen(e){this.open=e}setChecked(e){this.checked=e}setPos(e){this.pos=e}setParent(e){this.parent=e}getGCost(){return this.gCost}getHCost(){return this.hCost}getFCost(){return this.fCost}isStarting(){return this.starting}isGoal(){return this.goal}isSolid(){return this.solid}isOpen(){return this.open}isChecked(){return this.checked}getPos(){return this.pos}getParent(){return this.parent}}const R=class R{static initNode(e=s.CHUNK_SIZE,t=s.CHUNK_SIZE){this.maxPathWidth=e,this.maxPathHeight=t,this.nodes=[];for(let n=0;n<this.maxPathHeight;n++){this.nodes.push([]);for(let r=0;r<this.maxPathWidth;r++)this.nodes[n].push(new ae)}this.resetOthers()}static resetOthers(){this.checked=[],this.opened=[],this.path=[],this.goalReached=!1,this.foundPath=!0}static resetNodes(e=s.CHUNK_SIZE,t=s.CHUNK_SIZE){this.initNode(e,t);for(let n=0;n<this.maxPathHeight;n++)for(let r=0;r<this.maxPathWidth;r++){const h=this.nodes[n][r];h.setGCost(0),h.setFCost(0),h.setHCost(0),h.setSolid(!1),h.setGoal(!1),h.setStarting(!1),h.setParent(void 0),h.setChecked(!1),h.setOpen(!1)}this.resetOthers()}static setNodes(e,t,n,r,h,l=s.CHUNK_SIZE,m=s.CHUNK_SIZE){var d,f;this.resetNodes(m,l);let c=n-e,p=r-t;if(Math.abs(c)>=Math.floor(this.maxPathWidth/2)||Math.abs(p)>=Math.floor(this.maxPathHeight/2)){this.foundPath=!1;return}this.worldMap=h;const I=Math.floor(this.maxPathHeight/2),i=Math.floor(this.maxPathWidth/2);this.startNode=this.nodes[I][i],this.startNode.setStarting(!0),this.currentNode=this.startNode;const o=I+(r-t),a=i+(n-e);if(o<0||o>=this.maxPathHeight||a<0||a>=this.maxPathWidth){this.foundPath=!1;return}if(n==e&&r==e){this.goalReached=!0;return}this.goalNode=this.nodes[I+(r-t)][i+(n-e)],this.goalNode.setGoal(!0);for(let g=0;g<this.maxPathHeight;g++)for(let u=0;u<this.maxPathWidth;u++){const y=this.nodes[g][u],b=e-Math.floor(this.maxPathWidth/2)+u,T=t-Math.floor(this.maxPathHeight/2)+g,A=(b%s.CHUNK_SIZE+s.CHUNK_SIZE)%s.CHUNK_SIZE,L=(T%s.CHUNK_SIZE+s.CHUNK_SIZE)%s.CHUNK_SIZE,C=(f=(d=h.get(Math.floor(b/s.CHUNK_SIZE)+", "+Math.floor(T/s.CHUNK_SIZE)))==null?void 0:d[L])==null?void 0:f[A];if(b==n&&T==r&&(C!=null&&C.getLayers()[0].tile.getSettings().solid)){this.goalReached=!0;return}y.setPos({x:b,y:T}),C!=null&&C.getLayers()[0].tile.getSettings().solid&&y.setSolid(!0),this.getCost(y)}}static getCost(e){let t=Math.abs(e.getPos().x-this.startNode.getPos().x),n=Math.abs(e.getPos().y-this.startNode.getPos().y);e.setGCost(t+n),t=Math.abs(e.getPos().x-this.goalNode.getPos().x),n=Math.abs(e.getPos().y-this.goalNode.getPos().y),e.setHCost(t+n),e.setFCost(e.getGCost()+e.getHCost())}static search(){for(;this.foundPath&&!this.goalReached;){let e=this.currentNode.getPos();this.currentNode.setChecked(!0),this.checked.push(this.currentNode),this.removeOpen(this.currentNode);const t=e.y-this.startNode.getPos().y+Math.floor(this.maxPathWidth/2),n=e.x-this.startNode.getPos().x+Math.floor(this.maxPathWidth/2);if(n-1>=0&&this.openNode(this.nodes[t][n-1]),n+1<this.maxPathWidth&&this.openNode(this.nodes[t][n+1]),t-1>=0&&this.openNode(this.nodes[t-1][n]),t+1<this.maxPathHeight&&this.openNode(this.nodes[t+1][n]),this.opened.length===0){this.foundPath=!1;break}let r=0,h=999;for(let l=0;l<this.opened.length;l++){const m=this.opened[l].getFCost();m<h?(h=m,r=l):m==h&&this.opened[l].getGCost()<this.opened[r].getGCost()&&(r=l)}if(this.currentNode=this.opened[r],this.currentNode==this.goalNode){this.goalReached=!0,this.path=[];let l=this.goalNode;for(;l!==void 0;)this.path.unshift(l),l=l.getParent()}}return this.path}static removeOpen(e){for(let t=0;t<this.opened.length;t++)if(e==this.opened[t]){this.opened.splice(t,1);break}}static openNode(e){if(!e.isOpen()&&!e.isChecked()&&!e.isSolid()){const t=this.currentNode.getGCost()+1;e.setGCost(t);const n=Math.abs(e.getPos().x-this.goalNode.getPos().x),r=Math.abs(e.getPos().y-this.goalNode.getPos().y);e.setHCost(n+r),e.setFCost(e.getGCost()+e.getHCost()),e.setOpen(!0),e.setParent(this.currentNode),this.opened.push(e)}}static render(e,t){if(e.length!==0){t.fillStyle="#ffff00aa";for(const n of e){const r=n.getPos();t.fillRect(r.x*s.TILE_SIZE,r.y*s.TILE_SIZE,s.TILE_SIZE,s.TILE_SIZE)}}}static getGoal(){return this.goalNode}};R.maxPathWidth=s.CHUNK_SIZE,R.maxPathHeight=s.CHUNK_SIZE,R.path=[],R.checked=[],R.opened=[],R.startNode=new ae,R.goalNode=new ae,R.currentNode=new ae,R.foundPath=!0,R.goalReached=!1;let G=R;class rt{constructor(){this.pathUpdateTime=0,this.pathUpdateInterval=.5,this.lastTime=0,this.isFullscreen=!1,this.fullscreenhtml=[],this.renderPath=!1,this.run=!0,this.canvas=document.getElementById(s.CANVAS_ID),this.ctx=this.canvas.getContext("2d"),this.canvas.width=s.CANVAS_WIDTH*window.devicePixelRatio*3.25,this.canvas.height=s.CANVAS_HEIGHT*window.devicePixelRatio*3.25,this.ctx.imageSmoothingEnabled=!1,this.ctx.imageSmoothingQuality="high",this.ctx.scale(window.devicePixelRatio*3.25,window.devicePixelRatio*3.25),this.player=new Ae("TIm",new re(100,100),new O({x:100,y:100,width:8,height:12})),this.enemies=[new le(new re(50,100),new O({x:50,y:50,width:10,height:10})),new le(new re(50,100),new O({x:75,y:50,width:16,height:16}))];for(let e=0;e<Math.random()*10;e++)this.enemies.push(new le(new re(50,100),new O({x:Math.random()*200,y:Math.random()*200,width:10,height:10})));this.camera=new Ne({x:100,y:100,width:s.CANVAS_WIDTH,height:s.CANVAS_HEIGHT,zoom:1.35},"main"),this.camera.trackEntity(this.player),this.worldHandler=new it,this.uiHandler=new je(this.canvas,this.player,this.camera,this.worldHandler),this.setupEventListeners(),requestAnimationFrame(this.gameLoop.bind(this)),this.collisionHandler=new nt,this.inventoryHandler=new ot(this.canvas),this.entities=this.enemies,this.entities.push(this.player),this.unusedEntities=[],this.interactionHandler=new st(this.player,this.worldHandler,this.camera,this.inventoryHandler,this.entities),G.initNode(),document.addEventListener("keydown",e=>{e.key==="?"&&(e.preventDefault(),this.toggleFullScreen()),e.key==="c"&&this.collisionHandler.setPlayerCollisions(!1),e.key==="C"&&this.collisionHandler.setPlayerCollisions(!0)}),document.getElementById("fullscreenButton").addEventListener("click",()=>{this.toggleFullScreen()}),s.COMMAND_SYSTEM.addCommand("fullscreen",()=>this.toggleFullScreen()),s.COMMAND_SYSTEM.addCommand("renderPath",()=>this.renderPath=!this.renderPath)}toggleFullScreen(){if(this.isFullscreen){this.canvas.style.width=s.CANVAS_WIDTH+"px",this.canvas.style.height=s.CANVAS_HEIGHT+"px";for(let e=0;e<this.fullscreenhtml.length;e++)document.getElementsByClassName("hideFull")[e].innerHTML=this.fullscreenhtml[e];this.fullscreenhtml=[],document.getElementById("fullscreenButton").addEventListener("click",()=>{this.toggleFullScreen()})}else{for(let e=0;e<document.getElementsByClassName("hideFull").length;e++)this.fullscreenhtml.push(document.getElementsByClassName("hideFull")[e].innerHTML),document.getElementsByClassName("hideFull")[e].innerHTML="";this.canvas.style.width=screen.availWidth+"px",this.canvas.style.height=screen.availHeight+"px",this.canvas.style.margin="0px 0px 0px 0px",this.canvas.style.padding="0px 0px 0px 0px"}this.isFullscreen=!this.isFullscreen}setupEventListeners(){this.multiplayerEvents(),document.getElementById("playerColor").addEventListener("input",e=>{var t=document.getElementById("playerColor").value.replace("#","");this.player.getHitboxComponent().setColor({hex:t})})}multiplayerEvents(){}gameLoop(e){const t=(e-this.lastTime)/1e3;this.lastTime=e,this.update(t),this.render(),requestAnimationFrame(this.gameLoop.bind(this))}update(e){this.player.getHealthComponent().isDead()||this.player.update();for(let t=0;t<this.enemies.length;t++)this.enemies[t].update();if(this.collisionHandler.update(this.entities,this.unusedEntities,this.worldHandler.getWorldMap(),e),this.camera.update(),this.worldHandler.update(this.camera),this.interactionHandler.update(e),this.inventoryHandler.update(),this.uiHandler.update(),s.INPUT_HANDLER.wasJustLeftClicked()&&s.INPUT_HANDLER.setJustLeftClicked(!1),s.INPUT_HANDLER.wasJustRightClicked()&&s.INPUT_HANDLER.setJustRightClicked(!1),s.INPUT_HANDLER.wasJustMiddleClicked()&&s.INPUT_HANDLER.setJustMiddleClicked(!1),s.INPUT_HANDLER.getKeyToggled()[0]?this.camera.trackEntity(this.enemies[0]):this.camera.trackEntity(this.player),this.pathUpdateTime+=e,this.pathUpdateTime>=this.pathUpdateInterval){this.pathUpdateTime=0,this.enemies[0]&&!this.player.getHealthComponent().isDead()&&G.setNodes(Math.floor(this.enemies[0].getHitboxComponent().getHitbox().x/s.TILE_SIZE),Math.floor(this.enemies[0].getHitboxComponent().getHitbox().y/s.TILE_SIZE),Math.floor(this.player.getHitboxComponent().getHitbox().x/s.TILE_SIZE),Math.floor(this.player.getHitboxComponent().getHitbox().y/s.TILE_SIZE),this.worldHandler.getWorldMap());const t=G.search();this.enemies[1]&&!this.player.getHealthComponent().isDead()&&G.setNodes(Math.floor(this.enemies[1].getHitboxComponent().getHitbox().x/s.TILE_SIZE),Math.floor(this.enemies[1].getHitboxComponent().getHitbox().y/s.TILE_SIZE),Math.floor(this.player.getHitboxComponent().getHitbox().x/s.TILE_SIZE),Math.floor(this.player.getHitboxComponent().getHitbox().y/s.TILE_SIZE),this.worldHandler.getWorldMap()),G.search(),this.enemies[0]&&this.enemies[0].setPath(t)}s.TIME_HANDLER.addTime(e)}render(){this.ctx.clearRect(0,0,s.CANVAS_WIDTH,s.CANVAS_HEIGHT),this.ctx.save(),this.ctx.scale(this.camera.getView().zoom,this.camera.getView().zoom),this.ctx.translate(-this.camera.getView().x,-this.camera.getView().y),this.ctx.clearRect(0,0,s.CANVAS_WIDTH/this.camera.getView().zoom,s.CANVAS_HEIGHT/this.camera.getView().zoom),this.worldHandler.renderBackground(this.ctx,this.camera);for(let e=0;e<this.player.getLayer()+1;e++)this.worldHandler.renderLayer(e,this.ctx,this.camera);this.worldHandler.renderDropItems(this.ctx,this.camera);for(let e=0;e<this.enemies.length;e++)this.enemies[e].render(this.ctx);this.player.render(this.ctx),this.renderPath&&(G.render(this.enemies[0].getPath(),this.ctx),G.render(this.enemies[1].getPath(),this.ctx));for(let e=this.player.getLayer()+1;e<3;e++)this.worldHandler.renderLayer(e,this.ctx,this.camera);this.worldHandler.renderMouse(this.ctx,this.camera),this.ctx.restore(),this.inventoryHandler.render(this.ctx),this.uiHandler.render(this.ctx),this.ctx.fillStyle="black",this.ctx.font="20px serif",this.ctx.fillText(s.TIME_HANDLER.getTime()+" ",s.CANVAS_WIDTH/2,10)}running(){return this.run}}class at{constructor(){this.frameId=null,this.canvas=document.getElementById(s.CANVAS_ID),this.ctx=this.canvas.getContext("2d"),this.canvas.width=s.CANVAS_WIDTH*window.devicePixelRatio*3.25,this.canvas.height=s.CANVAS_HEIGHT*window.devicePixelRatio*3.25,this.ctx.imageSmoothingEnabled=!1,this.ctx.imageSmoothingQuality="high",this.ctx.scale(window.devicePixelRatio*3.25,window.devicePixelRatio*3.25),this.playButton=new V(this.canvas,{x:490,y:145,width:128,height:60},{red:0,green:0,blue:0,alpha:.001},!1,"",{red:0,green:0,blue:0,alpha:1e-4},1,"center",{red:0,green:0,blue:0,alpha:1e-4},{red:0,green:0,blue:0,alpha:1e-4},{red:0,green:0,blue:0,alpha:1e-4},()=>{this.startGame()}),this.init()}async init(){await this.loadRes(),w.getImages().forEach(e=>{var t;e.src.substring((t=e.src.match("resources"))==null?void 0:t.index)==="resources/typePlatformer/images/menu/main.png"&&(this.img=e)}),this.frameId=requestAnimationFrame(this.gameLoop.bind(this))}async loadRes(){await w.loadAllImages(),E.loadTilesImgs(),v.loadItemsImgs(),await M.loadAllSounds()}startGame(){var e,t;this.frameId!==null&&(cancelAnimationFrame(this.frameId),this.frameId=null),Math.random()*2<1?(e=M.getSounds()[oe.MUSIC0])==null||e.loop(!0).play():(t=M.getSounds()[oe.LIVING])==null||t.loop(!0).play(),this.game=new rt}render(){this.img&&this.ctx.drawImage(this.img,0,0,s.CANVAS_WIDTH,s.CANVAS_HEIGHT,0,0,s.CANVAS_WIDTH,s.CANVAS_HEIGHT),this.playButton.render(this.ctx)}update(){this.playButton.update()}gameLoop(e){this.update(),this.render(),this.frameId!=null&&(this.frameId=requestAnimationFrame(this.gameLoop.bind(this)))}}new at;
